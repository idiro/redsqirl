<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:ui="http://java.sun.com/jsf/facelets">

<a4j:loadBundle basename="MessagesResources" var="messages" />
		
    
	<h:form style="min-height:535px;background-color:white;" >
	    
        <h:panelGroup id="install_pck_main"
            rendered="#{packageMngBean.showMain}" style="min-height:535px;overflow:auto;" >
            
            <div id="welcomePageRepo">
                <ui:include src="#{packageMngBean.repoWelcomePage}" />
            </div>
            <h:dataTable value="#{packageMngBean.extPackages}" var="c"
                styleClass="order-table"
                headerClass="order-table-header"
                rowClasses="order-table-odd-row,order-table-even-row"
                rendered="#{not empty packageMngBean.extPackages}">
                <h:column>
                    <f:facet name="header">
                    Name
                </f:facet>
                    <a4j:commandLink value="#{c.name}"
                        action="#{packageMngBean.retrievesExtPackages}"
                        reRender="install_pck_spec">
                        <a4j:actionparam name="packageId"
                            value="#{c.id}" />
                    </a4j:commandLink>
                </h:column>
                <h:column>
                    <f:facet name="header">
                    License
                </f:facet>
                    #{c.license}
            </h:column>
                <h:column>
                    <f:facet name="header">
                    Description
                </f:facet>
                    #{c.short_description}
            </h:column>
            </h:dataTable>
        </h:panelGroup>
        <h:panelGroup id="install_pck_spec"  style="min-height:535px;overflow:auto;"
            rendered="#{not packageMngBean.showMain}" >
            
            
                
            <div id="header">
                <a4j:commandLink value="back"
                    action="#{packageMngBean.retrievesExtPackages}"
                    reRender="install_pck_main" />
                    
            </div>
            
            <div id="left">
            
                <ui:include src="#{packageMngBean.curPackage == null || packageMngBean.curPackage.description == null ? '/pages/blankPage.html' :  packageMngBean.curPackage.description}" />
                
                
                <h:dataTable value="#{packageMngBean.extPackages}"
                    var="c" styleClass="order-table"
                    headerClass="order-table-header"
                    rowClasses="order-table-odd-row,order-table-even-row">
                    <h:column>
                        <f:facet name="header">
                    Version
                </f:facet>
                        <a4j:commandLink value="#{c.version}"
                            action="#{packageMngBean.retrievesExtPackages}"
                            reRender="install_pck_spec">
                            <a4j:actionparam name="packageName"
                                value="#{c.name}" />
                            <a4j:actionparam name="version"
                                value="#{c.version}" />
                        </a4j:commandLink>
                    </h:column>
                </h:dataTable>
            </div>
            <div id="right">
                Date: #{packageMngBean.curPackage.dateStr}<br />
                License: #{packageMngBean.curPackage.license}<br />
                Version: #{packageMngBean.curPackage.version}<br />
                Price: #{packageMngBean.curPackage.price}<br />
	            <a4j:commandButton
	                styleClass="greenButton"
	                action="#{packageMngBean.installPackage}"
	                value="#{messages.button_install}"
	                oncomplete="if(#{requestScope['msnError'] == null} ){#{rich:component('modalInstallSuccess')}.show();}"
	                reRender="usPckList,sysPckList,msnError,errorTable">
	                <a4j:actionparam name="downloadUrl" value="#{packageMngBean.curPackage.url}" />
	            </a4j:commandButton>
            </div>
        </h:panelGroup>
	</h:form>
	
	<h:form>
    <a4j:jsFunction name="reStartFromInstall"
           action="#{userInfoBean.signOut}" />
	
	<rich:modalPanel id="modalInstallSuccess" width="300" height="120"
			style="overflow:auto;" resizeable="false">

			<f:facet name="header">Package Installed</f:facet>
			<f:facet name="controls">
				<h:graphicImage value="../image/icons/buttonCloseWindow.gif"
					style="cursor:pointer;width:22px;"
					onclick="#{rich:component('modalInstallSuccess')}.hide()" />
			</f:facet>

			<div style="background-color:white;height:95%;padding:3px;" >
			    
				<h:outputText value="#{messages.package_installed}" />
				<br />
				<rich:panel style="border:none;margin-top:10px;" >
				
				<a4j:commandButton value="#{messages.button_ok}" styleClass="greenButton"
                    style="margin-right:5px"
					onclick="#{rich:component('modalInstallSuccess')}.hide();">
				</a4j:commandButton>
				
                <a4j:commandButton value="#{messages.button_return_install}" styleClass="greenButton"
                    onclick="#{rich:component('modalInstallSuccess')}.hide();#{rich:component('modalInstallPackage')}.hide();">
                </a4j:commandButton>
				
				<a4j:commandButton value="#{messages.button_restart}" 
				    styleClass="greenButton"
				    style="margin-left:5px"
					onclick="#{rich:component('modalInstallSuccess')}.hide();#{rich:component('modalInstallPackage')}.hide();#{rich:component('modalPackage')}.hide();"
					oncomplete="reStartFromInstall();">
				</a4j:commandButton>
				
				</rich:panel>
			</div>

		</rich:modalPanel>
    </h:form>
</ui:composition>
