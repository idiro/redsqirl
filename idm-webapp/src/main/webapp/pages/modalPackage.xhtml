<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ui="http://java.sun.com/jsf/facelets">
    
<a4j:loadBundle basename="MessagesResources" var="messages" />
    
    <a4j:keepAlive beanName="packageMngBean"/>
    
    <a4j:region renderRegionOnly="true">
        <rich:modalPanel id="modalInstallPackage" width="900"
            height="600" style="overflow:auto;" resizeable="true">
            <f:facet name="header">Packages</f:facet>
            <f:facet name="controls">
                <h:graphicImage
                    value="../image/icons/buttonCloseWindow.gif"
                    style="cursor:pointer;width:22px;"
                    onclick="#{rich:component('modalInstallPackage')}.hide()" />
            </f:facet>
                <h:panelGroup>
                    <a4j:include
                        viewId="/pages/modalInstallPackage.xhtml"
                        ajaxRendered="true" />
                </h:panelGroup>
        </rich:modalPanel>
    </a4j:region>
    
    <h:form>
    <a4j:region>
        <a4j:status
            onstart="jQuery('#body').block({ message: jQuery('#domMessageDivCanvas1') });"
            onerror="jQuery('#body').unblock();"
            onsuccess="jQuery('#body').unblock();"
            onstop="jQuery('#body').unblock();" />
        <a4j:jsFunction name="openInstallPackageModal"
            action="#{packageMngBean.setPackageScope}"
            oncomplete="#{rich:component('modalInstallPackage')}.show();">
            <a4j:actionparam name="user"/>
        </a4j:jsFunction>
    </a4j:region>
    <h:panelGrid id="packageList" columns="2">
        <rich:panel id="systemPck" header="System Packages"
            style="overflow:auto;width:270px;height:390px;">
            <h:panelGroup id="sysPckMenu"
                style="overflow:auto;height:350px;"
                rendered="#{packageMngBean.admin}">
                <h:selectManyCheckbox
                    value="#{packageMngBean.unSysPackage}">
                    <f:selectItems
                        value="#{packageMngBean.systemPackages}" var="n"
                        itemLabel="#{n.label}" itemValue="#{n.value}" />
                </h:selectManyCheckbox>
            </h:panelGroup>
            <h:panelGroup id="sysPckList"
                rendered="#{not packageMngBean.admin}">
                <ui:repeat value="#{packageMngBean.systemPackages}"
                    var="item">
                    #{item}<br />
                </ui:repeat>
            </h:panelGroup>
            <h:panelGrid id="pck_sys_buttons" columns="2"
                rendered="#{packageMngBean.admin}">
                <rich:panel id="pck_sys_install">
                    <a4j:commandButton
                        styleClass="greenButton"
                        value="#{messages.button_sys_install}"
                        onclick="openInstallPackageModal('false');" />
                </rich:panel>
                <rich:panel id="pck_sys_uninstall">
                    <a4j:commandButton
                        styleClass="greenButton"
                        value="#{messages.button_sys_uninstall}"
                        action="#{packageMngBean.removeSystemPackage}"
                        oncomplete="" />
                </rich:panel>
            </h:panelGrid>
        </rich:panel>
        <rich:panel id="userPck" header="User Packages"
            style="overflow:auto;width:270px;height:390px;">
            <h:panelGroup id="usPckMenu"
                style="overflow:auto;height:350px;"
                rendered="#{packageMngBean.userAllowInstall}">
                <h:selectManyCheckbox
                    value="#{packageMngBean.unUserPackage}">
                    <f:selectItems
                        value="#{packageMngBean.userPackages}" var="n"
                        itemLabel="#{n.label}" itemValue="#{n.value}" />
                </h:selectManyCheckbox>
            </h:panelGroup>
            <h:panelGroup id="usPckList"
                rendered="#{not packageMngBean.userAllowInstall}">
                <ui:repeat value="#{packageMngBean.userPackages}"
                    var="item">
                    #{item}<br />
                </ui:repeat>
            </h:panelGroup>
            <h:panelGrid id="pck_user_buttons" columns="2"
                rendered="#{packageMngBean.userAllowInstall}">
                <rich:panel id="pck_user_install">
                    <a4j:commandButton
                        styleClass="greenButton"
                        value="#{messages.button_user_install}"
                        onclick="openInstallPackageModal('true');" />
                </rich:panel>
                <rich:panel id="pck_user_uninstall">
                    <a4j:commandButton
                        styleClass="greenButton"
                        value="#{messages.button_user_uninstall}"
                        action="#{packageMngBean.removeUserPackage}"
                        oncomplete="" />
                </rich:panel>
            </h:panelGrid>
        </rich:panel>
    </h:panelGrid>
    </h:form>
</ui:composition>
