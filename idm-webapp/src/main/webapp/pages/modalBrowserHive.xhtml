<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets">

<a4j:loadBundle basename="MessagesResources" var="messages" />

	<script>
		//<![CDATA[

		var file;
		function browserSelectOneRadio(radio, name, path) {
			console.log("radio " + radio);
			console.log("name " + name);
			console.log("path " + path);

			var inputs = document.getElementsByTagName("input");
			for ( var i = inputs.length - 1; i >= 0; i--) {
				if (inputs[i].getAttribute("type") === "radio") {
					inputs[i].checked = false;
				}
			}

			radio.checked = true;
			if (path.charAt(path.length - 1) == "/") {
				file = path + name;
			} else {
				file = path + "/" + name;
			}
		}

		function getPathHive(p) {
			console.log("path " + p);
			console.log("file " + file);
			if (file.search(p) == -1) {
				var ans = "";
				if (!file) {
					return p;
				}
				/* if (p.search("/") != -1) {
					var parts = p.split("/");
					var newPath = "/";
					for ( var i = 0; i < parts.length; i++) {
						if (parts[i] != "/" && parts[i] != "") {
							console.log("'" + parts[i] + "'");
							newPath += parts[i] + "/";
						}
					}
					if(file !=null){
						newPath+=file;
					}
					console.log("new path " + newPath);
					return newPath;
				} */
				var lastCHar = p.charAt(p.length - 1);
				if (lastCHar == "/") {
					//console.log("last char /" + p + " + " + file);
					ans = p + file;
				} else {
					//console.log("last char not / : " + p + " '/' " + file);
					ans = p + "/" + file;
				}

				console.log("returning : " + ans);

				return ans;
			} else {
				return file;
			}
		}

		//]]>
	</script>

	<a4j:keepAlive beanName="browserHiveBean" />
	<a4j:keepAlive beanName="canvasModalBean" />

	<h:outputText value="#{messages.label_path}" />
	<h:inputText id="pathOpenFile" label="Path"
		value="#{browserHiveBean.path}" maxlength="255" style="width:395px;" 
		onkeypress="return enableEnterKey(event, 'changePathModalBrowserHiveBtn');"/>
	<a4j:commandLink
	    id="changePathModalBrowserHiveBtn"
		action="#{browserHiveBean.changePath}"
		reRender="hdfsfsOpenFile" >
        <h:graphicImage id="btSearch" value="../image/icons/button-search.gif"
            title='#{messages.button_ok}' />
    </a4j:commandLink>
	<a4j:commandLink action="#{browserHiveBean.goPrevious}"
		reRender="pathOpenFile,hdfsfsOpenFile,hdfsOpenFileBtn">
		<h:graphicImage id="btPrev" value="../image/icons/button-previous.gif"
			title='#{messages.HiveInterface_previous_help}' />
	</a4j:commandLink>
	<a4j:commandLink action="#{browserHiveBean.goNext}"
		reRender="pathOpenFile,hdfsfsOpenFile,hdfsOpenFileBtn">
		<h:graphicImage id="btNext" value="../image/icons/button-next.gif"
			title='#{messages.HiveInterface_next_help}' />
	</a4j:commandLink>
	
	<a4j:commandLink action="#{browserHiveBean.goUp}" reRender="pathOpenFile,hdfsfsOpenFile,hdfsOpenFileBtn">
		<h:graphicImage id="browserHiveGoupBean" value="../image/icons/button_up.jpg" title='#{messages.hdfs_goup}' styleClass="fileSystemIcon" />
	</a4j:commandLink>
	<br />

	<div style="width: 100%; overflow: auto; height: 305px;margin-top:5px;margin-bottom:10px;">

		<rich:extendedDataTable id="hdfsfsOpenFile"
			value="#{browserHiveBean.listGrid}" var="item" width="100%"
			style="border:none;"
			onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
			enableContextMenu="false" selectionMode="none"
			onRowMouseOut="this.style.backgroundColor='#{a4jSkin.rowBackgroundColor}'"
			rowClasses="even-row, odd-row">

			<f:facet name="header">
				<h:outputText value="File System" />
			</f:facet>

			<rich:column style="border-bottom:0px;border-right:0px;"
				width="32px;">
				<f:facet name="header">
					<h:outputText value="" />
				</f:facet>
				<h:selectOneRadio value="#{item.stringSelectedDestination}"
					onclick="browserSelectOneRadio(this, '#{item.name}','#{browserHiveBean.path}');">
					<f:selectItem itemValue="true" />
				</h:selectOneRadio>

			</rich:column>
			<rich:column sortBy="#{item.name}"
				style="border-bottom:0px;border-right:0px;">
				<f:facet name="header">
					<h:outputText value="Name" />
				</f:facet>
				<a4j:commandLink value="#{item.name}"
					action="#{browserHiveBean.selectFile}"
					reRender="pathOpenFile,hdfsfsOpenFile,hdfsOpenFileBtn">
					<f:param name="nameFile" value="#{item.name}" />
				</a4j:commandLink>
			</rich:column>

			<rich:columns value="#{browserHiveBean.keyAsListNameValue}"
				var="column" index="ind" id="column#{ind}"
				style="border-bottom:0px;border-right:0px;">
				<f:facet name="header">
					<h:outputText value="#{column}" />
				</f:facet>
				<h:outputText value="#{item.nameValue[column]}" id="value#{ind}" />
			</rich:columns>

		</rich:extendedDataTable>

	</div>

	<a4j:commandButton styleClass="greenButton" action="#{canvasModalBean.changePathBrowser}"
		value="#{messages.button_ok}"
		oncomplete="if(#{requestScope['msnError'] == null} )#{rich:component('modalPanelBrowserHiveId')}.hide();"
		reRender="browserPanel, browserTable1, browserTable2, browserTable1Col1, browserTable1Col2 , pathOpenFile, msnError">
		<a4j:actionparam name="pathFile"
			value="getPathHive('#{browserHiveBean.path}')" noEscape="true" />
	</a4j:commandButton>

	<a4j:commandButton styleClass="greenButton" value="#{messages.button_cancel}"
		oncomplete="#{rich:component('modalPanelBrowserHiveId')}.hide();" />

</ui:composition>
