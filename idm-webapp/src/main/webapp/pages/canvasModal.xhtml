<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets">

	
		<script>

			function openBrowserChangePath(positions){
				jQuery("[id$='browserChangePathBt']").click();
			}
			
		</script>
		
		<h:form id="form1">
	
	<a4j:keepAlive beanName="canvasModalBean" />
	
	<rich:panel id="panelDynamicForm" style="border:none;" >
	
		<h:outputText value="#{canvasModalBean.pageLegend}" id="pageLegend" />
	
	
		<a4j:repeat value="#{canvasModalBean.dynamicFormList}" var="item" rowKeyVar="index" id="dynamicFormInteraction" >
			
			<h:outputText value="#{item.name}" />
			<br/>
			
			<!-- list -->
			
			<rich:comboBox value="#{item.selectedListOptions}" selectFirstOnUpdate="false" width="200" 
				listWidth="150" listHeight="200" enableManualInput="false" rendered="#{item.displayType == 'list'}" >
				<f:selectItems value="#{item.listOptions}" />
			</rich:comboBox>
			
			<!-- appendList -->
			
			<rich:comboBox value="#{item.selectedAppendListOptions}" selectFirstOnUpdate="false" width="200" 
				listWidth="150" listHeight="200" enableManualInput="false" rendered="#{item.displayType == 'appendList' and item.comboBox == 'Y'}" >
				<f:selectItems value="#{item.appendListOptions}" />
			</rich:comboBox>
			
			<h:selectManyListbox value="#{item.listSelectedAppendListOptions}" rendered="#{item.displayType == 'appendList' and item.comboBox == 'N'}" >
				<f:selectItems value="#{item.appendListOptions}" />
			</h:selectManyListbox>
			
			
			<!-- browser -->
			
			<rich:panel style="border:none;" rendered="#{item.displayType == 'browser'}" id="browserPanel" >
			
			
				<h:outputText value="#{messages.label_path}" />
				<br/>
				<h:inputText id="browserPath" label="Path" value="#{item.pathBrowser}" maxlength="255" 
					style="width:395px;" onclick="openBrowserChangePath();" />
					
				<a4j:commandButton type="submit" id="browserChangePathBt" action="#{canvasModalBean.changePathBrowserBefore}" 
					reRender="browserTable1,browserTable2" oncomplete="#{rich:component('modalPanelBrowserId')}.show()" style="display:none;" >
					<f:param name="numberDynamic" value="#{index}" />
				</a4j:commandButton>
	
				<br/><br/>
				
				<div id="DivBrowserTable1" style="width:580px; height:110px;  border:1px solid black; overflow-x: hidden;">
				
					<rich:dataTable id="browserTable1" value="#{item.listGrid}"
						var="item" width="100%" style="border:none;" onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
						enableContextMenu="false" onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'" >
						
						<rich:columns value="#{canvasModalBean.keyAsListNameValueListGrid}" var="column" index="ind" 
							style="border-bottom:0px;border-right:0px;" >
							<f:facet name="header">
								<h:outputText value="#{column}" />
							</f:facet>
							
							<h:inputText value="#{item.nameValue[column]}" style="width:125px;" />
							
						</rich:columns>
		
					</rich:dataTable>
				
				</div>
				
				<br/>
				
				<div id="DivBrowserTable2" style="width:580px; height:120px;  border:1px solid black; overflow-x: hidden;">
				
					<rich:dataTable id="browserTable2" value="#{item.listFeature}" 
						var="itemDiv2" width="100%" style="border:none;" onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
						enableContextMenu="false" onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'" >
						
						<rich:columns value="#{canvasModalBean.keyAsListNameValueFeature}" var="column" index="ind" rendered="#{not empty canvasModalBean.listFeature}" 
							style="border-bottom:0px;border-right:0px;" >
							<f:facet name="header">
								<h:outputText value="#{column}" />
							</f:facet>
							
							<h:inputText value="#{itemDiv2.nameValue[column]}" style="width:125px;" readonly="true" />
							
						</rich:columns>
		
					</rich:dataTable>
		
				</div>
				
			</rich:panel>
			
			<!-- helpTextEditor -->
			<!-- table -->
			
			<br />
			
		</a4j:repeat>
		
		
	</rich:panel>
		
		<br/><br/>
	
	
		<rich:panel id="panelBtCanvasModal" style="border:none; float:right;" >
		
			<a4j:commandButton action="#{canvasModalBean.close}" value="#{messages.button_cancel}" onclick="#{rich:component('canvasModalPanel')}.hide()" reRender="panelBtCanvasModal" />
			
			<a4j:commandButton action="#{canvasModalBean.previousPage}" value="#{messages.button_previous}" rendered="#{canvasModalBean.firstPage == 'N'}" reRender="panelDynamicForm, panelBtCanvasModal, browserPanel" />
			
			<a4j:commandButton action="#{canvasModalBean.nextPage}" value="#{messages.button_next}" rendered="#{canvasModalBean.lastPage == 'N'}" reRender="panelDynamicForm, panelBtCanvasModal, browserPanel, browserTable2" />
			
			<a4j:commandButton action="#{canvasModalBean.endDynamicForm}" value="#{messages.button_ok}" rendered="#{canvasModalBean.lastPage == 'S'}" reRender="panelBtCanvasModal" oncomplete="#{rich:component('canvasModalPanel')}.hide()" />
		
		</rich:panel>
	
	</h:form>
	
	
			<rich:modalPanel id="modalPanelBrowserId" width="600" height="400" style="overflow:auto;" resizeable="false">
	
				<f:facet name="header">Browser</f:facet>
				<f:facet name="controls">
					<h:graphicImage value="../image/icons/buttonCloseWindow.gif" style="cursor:pointer"
						onclick="#{rich:component('modalPanelBrowserId')}.hide()" />
				</f:facet>
		
				<h:form id="modalBrowserId">
					<h:panelGroup>
						<a4j:include viewId="/pages/modalBrowser.xhtml" ajaxRendered="false" />
					</h:panelGroup>
				</h:form>
		
			</rich:modalPanel>
	
        </rich:tab>
        
		<rich:tab label="Output">

			<h:panelGrid id="dataOutputForm">
				<a4j:repeat value="#{canvasModalBean.outputFormList}" var="item"
					rowKeyVar="index">
					<h:panelGrid columns="5">
						<h:outputText value="#{item.name}" />
						<rich:comboBox id="outputCombo" selectFirstOnUpdate="false"
							width="200" value="#{item.savingState}" listWidth="150"
							listHeight="200" enableManualInput="false">
							<f:selectItems value="#{item.savingStateList}" />
							<a4j:support event="onchange" reRender="dataOutputForm" />
						</rich:comboBox>
	
						<a4j:commandButton value="Select"
							rendered="#{item.renderBrowserButton and item.hdfsBrowser}"
							oncomplete="#{rich:component('modalOutputBrowserHdfs')}.show()">
							<a4j:actionparam name="nameOutput" value="#{item.name}"
								assignTo="#{canvasModalBean.nameOutput}" />
						</a4j:commandButton>
						
						<a4j:commandButton value="Select"
							rendered="#{item.renderBrowserButton and item.hiveBrowser}"
							oncomplete="#{rich:component('modalOutputBrowserHive')}.show()">
							<a4j:actionparam name="nameOutput" value="#{item.name}"
								assignTo="#{canvasModalBean.nameOutput}" />
						</a4j:commandButton>
						
						<h:outputText value="#{item.path}"/>
						
						<h:inputText value="#{item.file}"
							maxlength="40" style="width:100px;" rendered="#{item.renderBrowserButton}"/>
					</h:panelGrid>
				</a4j:repeat>
				
				<a4j:commandButton value="Apply" action="#{canvasModalBean.confirmOutput}"/>

			</h:panelGrid>
			
			<rich:modalPanel id="modalOutputBrowserHive" width="600" height="400"
				style="overflow:auto;" resizeable="false">

				<f:facet name="header">Browser</f:facet>
				<f:facet name="controls">
					<h:graphicImage value="../image/icons/buttonCloseWindow.gif"
						style="cursor:pointer"
						onclick="#{rich:component('modalOutputBrowserHive')}.hide()" />
				</f:facet>

				<h:form id="modalOutputBrowserHiveId">
					<h:panelGroup>
						<a4j:include viewId="/pages/modalOutputBrowserHive.xhtml"
							ajaxRendered="true">
						</a4j:include>
					</h:panelGroup>
				</h:form>

			</rich:modalPanel>
			
			<rich:modalPanel id="modalOutputBrowserHdfs" width="600" height="400"
				style="overflow:auto;" resizeable="false">

				<f:facet name="header">Browser</f:facet>
				<f:facet name="controls">
					<h:graphicImage value="../image/icons/buttonCloseWindow.gif"
						style="cursor:pointer"
						onclick="#{rich:component('modalOutputBrowserHdfs')}.hide()" />
				</f:facet>

				<h:form id="modalOutputBrowserHdfsId">
					<h:panelGroup>
						<a4j:include viewId="/pages/modalOutputBrowserHdfs.xhtml"
							ajaxRendered="true">
						</a4j:include>
					</h:panelGroup>
				</h:form>

			</rich:modalPanel>
			
		</rich:tab>
	</rich:tabPanel>
	</h:form>
</ui:composition>
