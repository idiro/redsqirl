<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets">

	
		<script>

			function openBrowserChangePath(positions){
				jQuery("[id$='browserChangePathBt']").click();
			}
			
			function verifyErrors(error){
				if (!error){
					closeDynamicForm();
				}
			}
			
		</script>
		
		<h:form id="formCanvasModal">
	

		
	<a4j:region>
		<a4j:jsFunction name="endDynamicForm" action="#{canvasModalBean.endDynamicForm}" data="#{canvasModalBean.errorMsg}" oncomplete="verifyErrors(data);" 
		reRender="panelDynamicForm, panelBtCanvasModal, browserPanel, browserTable2, msnError"/>
		
		<a4j:jsFunction name="closeDynamicForm" oncomplete="#{rich:component('canvasModalPanel')}.hide()" />
	</a4j:region>
	
	<rich:tabPanel id="canvasModalTabPanel" switchType="ajax" selectedTab="#{canvasModalBean.selectedTab}" >
	
	
			<div id="domMessageDivModal" style="display: none;">
				<img src="../image/icons/waiting.gif" />
			</div>
			
			<a4j:status	onstart="jQuery.blockUI({ message: jQuery('#domMessageDivModal') });"
				onerror="jQuery.unblockUI();" onsuccess="jQuery.unblockUI();"
				onstop="jQuery.unblockUI();" />
	
	
	
    <rich:tab id="tab1" label="#{messages.label_dynamic_configuration}" >
	<rich:panel id="panelDynamicForm" style="border:none;" >
	
	
		
		<img src="#{canvasModalBean.pathImage}" style="margin-top:-25px;margin-left:-15px;"/>
		<center><h:outputText value="#{canvasModalBean.tabTitle}" style="font-size:30px;"/></center>
				
		
		<br/>
		<p><h:outputText value="#{canvasModalBean.tabLegend}"/></p>
		
	
		<a4j:repeat value="#{canvasModalBean.dynamicFormList}" var="item" rowKeyVar="index" id="dynamicFormInteraction" >
			
			<h2><h:outputText value="#{item.name}"/></h2>
			
			<p><h:outputText value="#{item.legend}"/></p>
			
			<!-- list -->
			
			<a4j:region>
				<rich:comboBox value="#{item.selectedListOptions}" selectFirstOnUpdate="false" width="200" 
					listWidth="150" listHeight="200" enableManualInput="false" rendered="#{item.displayType == 'list'}" >
					<f:selectItems value="#{item.listOptions}" />
				</rich:comboBox>
			</a4j:region>
			
			<!-- appendList -->
			
			<a4j:region>
				<rich:comboBox value="#{item.selectedAppendListOptions}" selectFirstOnUpdate="false" width="200" 
					listWidth="150" listHeight="200" enableManualInput="false" rendered="#{item.displayType == 'appendList' and item.comboBox == 'Y'}" >
					<f:selectItems value="#{item.appendListOptions}" />
				</rich:comboBox>
				
				<h:selectManyListbox value="#{item.selectedAppendListOptions}" rendered="#{item.displayType == 'appendList' and item.comboBox == 'N'}" >
					<f:selectItems value="#{item.appendListOptions}" />
				</h:selectManyListbox>
			</a4j:region>
			
			
			<!-- browser -->
			<a4j:region>
				<rich:panel style="border:none;" rendered="#{item.displayType == 'browser'}" id="browserPanel" >
				
				
					<h:outputText value="#{messages.label_path}" />
					<br/>
					<h:inputText id="browserPath" label="Path" value="#{item.pathBrowser}" maxlength="255" 
						style="width:395px;" onclick="openBrowserChangePath();" />
					
					<h:inputHidden value="#{canvasModalBean.hiveHdfs}" id="hiveHdfs" />
					
					<a4j:commandButton type="submit" id="browserChangePathBt" action="#{canvasModalBean.changePathBrowserBefore}" 
						reRender="browserTable1,browserTable2,hiveHdfs" oncomplete="if(#{canvasModalBean.hiveHdfs == 'hive'}){ #{rich:component('modalPanelBrowserHiveId')}.show() }else{ #{rich:component('modalPanelBrowserHdfsId')}.show() }" style="display:none;" >
						<f:param name="numberDynamic" value="#{index}" />
					</a4j:commandButton>
		
					<br/><br/>
					
					<div id="DivBrowserTable1" style="width:580px; height:50px;  border:1px solid black; overflow-x: hidden;">
					
						<rich:dataTable id="browserTable1" value="#{item.listGrid}"
							var="item" width="100%" style="border:none;" onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
							enableContextMenu="false" onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'" >
							
							<rich:column id="browserTable1Col1" rendered="#{canvasModalBean.listGrid != null and not empty canvasModalBean.listGrid}" >
								<f:facet name="header">
									<h:outputText value="#{messages.label_properties}" />
								</f:facet>
								<h:inputText value="#{item.propertie}" style="width:125px;" readonly="true" />
							</rich:column>
							<rich:column id="browserTable1Col2" rendered="#{canvasModalBean.listGrid != null and not empty canvasModalBean.listGrid}" >
								<f:facet name="header">
									<h:outputText value="#{messages.label_value}" />
								</f:facet>
								<h:inputText value="#{item.value}" style="width:125px;" />
							</rich:column>
			
						</rich:dataTable>
					
					</div>
					
					<br/>
					
					<div id="DivBrowserTable2" style="width:580px; height:120px;  border:1px solid black; overflow-x: hidden;">
					
						<rich:dataTable id="browserTable2" value="#{item.listFeature}" 
							var="itemDiv2" width="100%" style="border:none;" onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
							enableContextMenu="false" onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'" >
							
							<rich:columns value="#{canvasModalBean.browserNameFeatureColumns}" var="column" index="ind" rendered="#{not empty canvasModalBean.listFeature and canvasModalBean.hiveHdfs == 'hive'}" 
								style="border-bottom:0px;border-right:0px;" >
								
								<f:facet name="header" rendered="#{canvasModalBean.hiveHdfs == 'hive'}">
							            <h:outputText value="#{column}" />
								</f:facet>
								
								<h:inputText value="#{itemDiv2.nameValue[column]}" style="width:125px;" readonly="true" />
								
							</rich:columns>
							
							<rich:columns value="#{canvasModalBean.browserNameFeatureColumns}" var="column" index="ind" rendered="#{not empty canvasModalBean.listFeature and canvasModalBean.hiveHdfs == 'hdfs'}" 
								style="border-bottom:0px;border-right:0px;" >
								<f:facet name="header" rendered="#{canvasModalBean.hiveHdfs == 'hdfs'}">
									 <h:panelGrid columns="2" width="100%" >
							            <h:outputText value="#{canvasModalBean.nameBrowserLabel2[column]}" />
							            <h:inputText value="#{canvasModalBean.nameBrowserLabel1[column]}" style="width:75px;" />
							        </h:panelGrid>
								</f:facet>
								
								<h:inputText value="#{itemDiv2.nameValue[column]}" style="width:125px;" readonly="true" />
								
							</rich:columns>
			
						</rich:dataTable>
			
					</div>
					
				</rich:panel>
			</a4j:region>
			
			<!-- helpTextEditor -->
			
			<a4j:region>
				<rich:panel style="border:none;" rendered="#{item.displayType == 'helpTextEditor'}" id="helpTextEditorPanel" >
					<h:outputText value="#{messages.label_formula}" /> <br/>
					<h:inputTextarea maxlength="100" cols="70" rows="10" value="#{canvasModalBean.command}" style="resize:none;" id="command">
						<a4j:support event="onclick" action="#{canvasModalBean.openHelpTextEditorModal}" oncomplete="#{rich:component('textEditorPanel')}.show()" 
							reRender="commandText,listFields,lisFunctions,listCategories">
							<a4j:actionparam  name="command" value="#{canvasModalBean.command}"/>
						</a4j:support>
					</h:inputTextarea>
					
					<br/><br/>
				</rich:panel>
			</a4j:region>
			
			<!-- table -->
			<a4j:region>
				<rich:panel style="border:none;"
					rendered="#{item.displayType == 'table'}" id="tablePanel">
					
	
					<h:panelGrid id="table" columns="3" rendered="#{!empty canvasModalBean.listItens}">
					<h:outputText value="#{messages.label_generation}" />
						<rich:comboBox
							value="#{canvasModalBean.selectedGenerator}" width="200"
							enableManualInput="false" id="generation" listWidth="150"
							listHeight="200">
							<f:selectItems value="#{canvasModalBean.listItens}" />
						</rich:comboBox>

						<a4j:commandButton type="submit"
							id="tableInteractionGenerationLines"
							action="#{canvasModalBean.tableInteractionGenerationLines}"
							value="#{messages.button_ok}" reRender="tableInteraction">
						</a4j:commandButton>
						
					</h:panelGrid>
					
					<br />
					<br />
	
					<div id="DivTableInteraction"
						style="width: 580px; height: 220px; border: 1px solid black; overflow-x: hidden;">
	
						<rich:dataTable id="tableInteraction"
							value="#{canvasModalBean.listGrid}" var="item" width="100%"
							style="border:none;"
							rowKeyVar="row"
							onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
							enableContextMenu="false"
							onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'">
	
							<rich:column style="border-bottom:0px;border-right:0px;"
								width="10px;">
								<f:facet name="header">
									<a4j:commandLink
										action="#{canvasModalBean.tableInteractionDeleteLine}"
										reRender="tableInteraction"
										onclick="if(!confirm('Are you sure you want to delete the selected line?')){return false;}">
										<img id="tableInteractionBtDelete"
											src="../image/icons/button-delete.png" />
									</a4j:commandLink>
								</f:facet>
	
								<h:selectBooleanCheckbox value="#{item.selected}">
									<f:selectItem itemValue="true" />
								</h:selectBooleanCheckbox>
	
							</rich:column>
							
							<rich:columns value="#{canvasModalBean.tableInteractionColumns}"
								var="column" index="ind"
								style="border-bottom:0px;border-right:0px;">
								<f:facet name="header">
									<h:outputText value="#{column}" />
								</f:facet>
	
								<h:inputText value="#{item.nameValue[column]}"
									rendered="#{canvasModalBean.columnsMap[column] == 'textField' }"
									style="width:125px;" />
	
								<rich:comboBox value="#{item.nameValue[column]}"
									selectFirstOnUpdate="false" defaultLabel="Enter some value"
									width="125" enableManualInput="false" listWidth="150"
									listHeight="150"
									rendered="#{canvasModalBean.columnsMap[column] == 'comboBox' }">
									<f:selectItems value="#{canvasModalBean.listConstraint[column]}" />
								</rich:comboBox>
	
								<h:inputText value="#{item.nameValue[column]}"
									rendered="#{canvasModalBean.columnsMap[column] == 'editor' }"
									style="width:125px;" >
									<a4j:support event="onclick" action="#{canvasModalBean.openHelpTextEditorModal}" 
										oncomplete="#{rich:component('textEditorPanel')}.show()" 
										reRender="commandText,listFields,lisFunctions,listCategories">
										<a4j:actionparam  name="command" value="#{item.nameValue[column]}"/>
										<a4j:actionparam  name="rowKey" value="#{row}"/>
										<a4j:actionparam  name="column" value="#{column}"/>
									</a4j:support>
								</h:inputText>
	
							</rich:columns>
	
						</rich:dataTable>
	
					</div>
					
					<a4j:commandLink
						action="#{canvasModalBean.tableInteractionAddNewLine}"
						reRender="tableInteraction">
						<img id="tableInteractionBtAdd"
							src="../image/icons/button-plus.gif" />
					</a4j:commandLink>
					
				</rich:panel>

			</a4j:region>
		<br />
			
		</a4j:repeat>
		
		
	</rich:panel>
		
		<br/><br/>
	
	
		<rich:panel id="panelBtCanvasModal" style="border:none; float:right;" >
		
			<a4j:commandButton action="#{canvasModalBean.close}" value="#{messages.button_cancel}" onclick="#{rich:component('canvasModalPanel')}.hide()" reRender="panelBtCanvasModal, msnError" />
			
			<a4j:commandButton action="#{canvasModalBean.previousPage}" value="#{messages.button_previous}" rendered="#{canvasModalBean.firstPage == 'N'}" reRender="panelDynamicForm, panelBtCanvasModal, browserPanel, msnError" />
			
			<a4j:commandButton action="#{canvasModalBean.applyPage}" value="#{messages.button_apply}" reRender="panelDynamicForm, panelBtCanvasModal, browserPanel, browserTable2, msnError, canvasModalTabPanel" />

			<a4j:commandButton action="#{canvasModalBean.nextPage}" value="#{messages.button_next}" rendered="#{canvasModalBean.lastPage == 'N'}" reRender="panelDynamicForm, panelBtCanvasModal, browserPanel, browserTable2, msnError" />
			
			<a4j:commandButton onclick="endDynamicForm()" value="#{messages.button_ok}" rendered="#{canvasModalBean.lastPage == 'Y'}"/>
		
		</rich:panel>
	
	 </rich:tab>
        
		<rich:tab id="outputTab" label="#{messages.label_dynamic_data}" rerender="dataOutputForm" rendered="#{canvasModalBean.showOutputForm == 'Y'}" >

			<h:panelGrid id="dataOutputForm">
				<a4j:repeat value="#{canvasModalBean.outputFormList}" var="item"
					rowKeyVar="index">
					<h:panelGrid columns="6">
						<h:outputText value="#{item.name}" />
						<rich:comboBox id="outputCombo" selectFirstOnUpdate="false"
							width="200" value="#{item.savingState}" listWidth="150"
							listHeight="200" enableManualInput="false">
							<f:selectItems value="#{item.savingStateList}" />
							<a4j:support event="onchange" reRender="dataOutputForm" />
						</rich:comboBox>
	
						<a4j:commandButton value="Select"
							rendered="#{item.renderBrowserButton and item.hdfsBrowser}"
							oncomplete="#{rich:component('modalOutputBrowserHdfs')}.show()">
							<a4j:actionparam name="nameOutput" value="#{item.name}"
								assignTo="#{canvasModalBean.nameOutput}" />
						</a4j:commandButton>
						
						<a4j:commandButton value="Select"
							rendered="#{item.renderBrowserButton and item.hiveBrowser}"
							action="#{hiveBean.openCanvasScreen}"
							oncomplete="#{rich:component('modalOutputBrowserHive')}.show();resetSelectedFile();">
							<a4j:actionparam name="nameOutput" value="#{item.name}"
								assignTo="#{canvasModalBean.nameOutput}" />
						</a4j:commandButton>
						
						<h:outputText value="#{item.path}"/>
						
						<h:inputText value="#{item.file}"
							maxlength="40" style="width:100px;" rendered="#{item.renderBrowserButton}"/>
							
						<a4j:commandButton value="#{messages.button_remove}" action="#{canvasModalBean.removeCleanOutput}" >
							<a4j:actionparam name="nameOutputClean" value="#{item.name}" assignTo="#{canvasModalBean.nameOutput}" />
						</a4j:commandButton>
							
					</h:panelGrid>
				</a4j:repeat>
				
				<h:panelGrid columns="2">
					<a4j:commandButton value="#{messages.button_apply}" action="#{canvasModalBean.confirmOutput}" />
					<a4j:commandButton value="#{messages.button_ok}" action="#{canvasModalBean.confirmOutput}" oncomplete="#{rich:component('canvasModalPanel')}.hide()"/>
				</h:panelGrid>

			</h:panelGrid>
			
			<rich:modalPanel id="modalOutputBrowserHive" width="600" height="400"
				style="overflow:auto;" resizeable="false">
	
				<f:facet name="header">Browser</f:facet>
				<f:facet name="controls">
					<h:graphicImage value="../image/icons/buttonCloseWindow.gif"
						style="cursor:pointer"
						onclick="#{rich:component('modalOutputBrowserHive')}.hide()" />
				</f:facet>
	
				<h:form id="modalOutputBrowserHiveId">
					<h:panelGroup>
						<a4j:include viewId="/pages/modalOutputBrowserHive.xhtml"
							ajaxRendered="true">
						</a4j:include>
					</h:panelGroup>
				</h:form>
	
			</rich:modalPanel>
			
			<rich:modalPanel id="modalOutputBrowserHdfs" width="600" height="400"
				style="overflow:auto;" resizeable="false">
	
				<f:facet name="header">Browser</f:facet>
				<f:facet name="controls">
					<h:graphicImage value="../image/icons/buttonCloseWindow.gif"
						style="cursor:pointer"
						onclick="#{rich:component('modalOutputBrowserHdfs')}.hide()" />
				</f:facet>
	
				<h:form id="modalOutputBrowserHdfsId">
					<h:panelGroup>
						<a4j:include viewId="/pages/modalOutputBrowserHdfs.xhtml"
							ajaxRendered="true">
						</a4j:include>
					</h:panelGroup>
				</h:form>
	
			</rich:modalPanel>
			
		</rich:tab>
	</rich:tabPanel>
	
	</h:form>
	
	
			<rich:modalPanel id="modalPanelBrowserHiveId" width="600" height="400" style="overflow:auto;" resizeable="false">
	
				<f:facet name="header">Browser</f:facet>
				<f:facet name="controls">
					<h:graphicImage value="../image/icons/buttonCloseWindow.gif" style="cursor:pointer"
						onclick="#{rich:component('modalPanelBrowserHiveId')}.hide()" />
				</f:facet>
		
				<h:form id="modalBrowserHiveId">
					<h:panelGroup>
						<a4j:include viewId="/pages/modalBrowserHive.xhtml" ajaxRendered="false" />
					</h:panelGroup>
				</h:form>
		
			</rich:modalPanel>
			
			<rich:modalPanel id="modalPanelBrowserHdfsId" width="600" height="400" style="overflow:auto;" resizeable="false">
	
				<f:facet name="header">Browser</f:facet>
				<f:facet name="controls">
					<h:graphicImage value="../image/icons/buttonCloseWindow.gif" style="cursor:pointer"
						onclick="#{rich:component('modalPanelBrowserHdfsId')}.hide()" />
				</f:facet>
		
				<h:form id="modalBrowserHdfsId">
					<h:panelGroup>
						<a4j:include viewId="/pages/modalBrowserHdfs.xhtml" ajaxRendered="false" />
					</h:panelGroup>
				</h:form>
		
			</rich:modalPanel>
			
			<rich:modalPanel id="textEditorPanel" width="600"
					height="400" style="overflow:auto;" resizeable="false">
					<f:facet name="header">Configuration</f:facet>
					<f:facet name="controls">
						<h:graphicImage value="../image/icons/buttonCloseWindow.gif"
							style="cursor:pointer"
							onclick="#{rich:component('textEditorPanel')}.hide()" />
					</f:facet>
					<ui:include src="/pages/canvasModal2.xhtml" />
			</rich:modalPanel>
			
	
</ui:composition>
