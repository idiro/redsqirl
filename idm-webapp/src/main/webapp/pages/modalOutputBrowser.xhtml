<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets">

<a4j:loadBundle basename="MessagesResources" var="messages" />

	<script>
//<![CDATA[
           
	var outputBroswerfile;
	function outPutBrowserSelectOneRadio(radio, name) {

		var inputs = document.getElementsByTagName("input");
		for(var i = inputs.length-1;i>=0;i--){
		    if(inputs[i].getAttribute("type")==="radio"){
		        inputs[i].checked=false;
		    }
		}
		   
	    radio.checked = true;
	    outputBroswerfile = name;
	}
	
	function getPathOutPut(p){
		if (!outputBroswerfile){
			return p;
		}
		var lastCHar = p.charAt(p.length-1);
		if(lastCHar == "/"){
			return p + outputBroswerfile;
		}else{
			return p + "/"+ outputBroswerfile;
		}
	}
	
//]]>
</script>

    <a4j:region>
       <a4j:jsFunction name="modalOutputApplyPage" action="#{canvasModalBean.applyPage}" styleClass="greenButton" value="#{messages.button_apply}" 
	reRender="panelDynamicForm, panelBtCanvasModal, browserPanel, msnError, errorTable, canvasModalTabPanel, browserTableProp, browserTableData, browserPropLabel, browserPropValue" />
    </a4j:region>

	<a4j:jsFunction name="changePathModalOutput" action="#{canvasModalBean.outputTab.fileSystem.changePath}" />

	<h:outputText value="#{messages.label_path}" />
	<h:inputText id="pathDataOutputBrowser" label="Path" value="#{canvasModalBean.outputTab.fileSystem.path}" maxlength="255" style="width:395px;" />
	
	<a4j:commandLink action="#{canvasModalBean.outputTab.fileSystem.changePath}" reRender="dataOutputBrowser">
		<h:graphicImage value="../image/icons/button-search.gif" title='#{messages.filesystem_change_path}' />
	</a4j:commandLink>
	
	<a4j:commandLink action="#{canvasModalBean.outputTab.fileSystem.goPrevious}"
		reRender="pathDataOutputBrowser,dataOutputBrowser">
		<h:graphicImage value="../image/icons/button-previous.gif" title='#{messages.Interface_previous_help}' />
	</a4j:commandLink>
	
	<a4j:commandLink action="#{canvasModalBean.outputTab.fileSystem.goNext}"
		reRender="pathDataOutputBrowser,dataOutputBrowser">
		<h:graphicImage value="../image/icons/button-next.gif" title='#{messages.Interface_next_help}' />
	</a4j:commandLink>
	
	<a4j:commandLink action="#{canvasModalBean.outputTab.fileSystem.goUp}" reRender="pathDataOutputBrowser,dataOutputBrowser">
		<h:graphicImage value="../image/icons/button_up.jpg" title='#{messages.hdfs_goup}' styleClass="fileSystemIcon" />
	</a4j:commandLink>
	<br />
	
	<div style="width:100%; overflow: auto; height: 265px;" >

		<rich:extendedDataTable id="dataOutputBrowser" value="#{canvasModalBean.outputTab.fileSystem.tableGrid.rows}"
			var="item" rowKeyVar="indexTable" width="100%" style="border:none;"
			onRowMouseOver="this.style.backgroundColor='#F1F1F1'" enableContextMenu="false" selectionMode="none"
			onRowMouseOut="this.style.backgroundColor='#{a4jSkin.rowBackgroundColor}'" rowClasses="even-row, odd-row">
	
			<rich:column style="border-bottom:0px;border-right:0px;" width="35px;">
				<f:facet name="header">
					<h:outputText value="" />
				</f:facet>
				<h:selectOneRadio value="#{item.selectedStr}" onclick="outPutBrowserSelectOneRadio(this, '#{canvasModalBean.outputTab.fileSystem.allProps[indexTable]['name']}');"
				rendered="#{item.disableSelect}" >
					<f:selectItem itemValue="true" />
				</h:selectOneRadio>
			</rich:column>
	
			<rich:column sortBy="#{canvasModalBean.outputTab.fileSystem.allProps[indexTable]['name']}"
				style="border-bottom:0px;border-right:0px;">
				<f:facet name="header">
					<h:outputText value="#{messages.label_name}" />
				</f:facet>
				<a4j:commandLink 
				    value="#{canvasModalBean.outputTab.fileSystem.allProps[indexTable]['name']}"
				    title="#{canvasModalBean.outputTab.fileSystem.allProps[indexTable]['name']}"
				    action="#{canvasModalBean.outputTab.fileSystem.selectFile}"
					reRender="pathDataOutputBrowser,dataOutputBrowser">
					<f:param name="nameFile" value="#{canvasModalBean.outputTab.fileSystem.allProps[indexTable]['name']}" />
				</a4j:commandLink>
			</rich:column>
	
			<rich:columns value="#{canvasModalBean.outputTab.fileSystem.tableGrid.titles == null? canvasBean.emptyList : canvasModalBean.outputTab.fileSystem.tableGrid.titles}" 
				var="column" index="ind" style="border-bottom:0px;border-right:0px;">
				<f:facet name="header">
					<h:outputText value="#{column}" />
				</f:facet>
				<h:outputText value="#{item.row[ind]}" title="#{item.row[ind]}" />
			</rich:columns>
	
		</rich:extendedDataTable>

	</div>
	
	<br />
	
	<rich:comboBox value="#{canvasModalBean.outputTab.fileSystem.extensionsSelected}" width="200" enableManualInput="false"
		id="generation" listWidth="150" listHeight="200" rendered="#{not empty canvasModalBean.outputTab.fileSystem.listExtensions}" 
		onchange="changePathModalOutput();" style="padding-right:20px;float:right;" >
        <f:selectItems styleClass="interModal" value="#{canvasModalBean.outputTab.fileSystem.listExtensions}" />
   </rich:comboBox>
   
   <br />

	<a4j:commandButton styleClass="greenButton" 
	    action="#{canvasModalBean.outputTab.changePathOutputBrowser}" 
	    value="#{messages.button_ok}"
		onclick="#{rich:component('modalOutputBrowser')}.hide();" 
		reRender="dataOutputForm"
		oncomplete="if(#{canvasModalBean.sourceNode})modalOutputApplyPage();" >
		<a4j:actionparam name="pathFile" value="getPathOutPut('#{canvasModalBean.outputTab.fileSystem.path}')" noEscape="true" />
	</a4j:commandButton>

	<a4j:commandButton styleClass="greenButton" value="#{messages.button_cancel}" onclick="#{rich:component('modalOutputBrowser')}.hide();" />

</ui:composition>