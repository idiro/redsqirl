<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j">

<a4j:loadBundle basename="MessagesResources_en_IE" var="messages" />

<head>

<script>

	function completeCommand(text){
	    var txtarea = jQuery("[id$='commandText']");
	    var scrollPos = txtarea.scrollTop;
	    var strPos = 0;
	    strPos = txtarea.getCursorPosition();
	    var front = (txtarea.val().trim()).substring(0,strPos);
	    var back = (txtarea.val().trim()).substring(strPos,txtarea.val().length);
	    txtarea.val(front + text.trim() + back);
	    strPos = strPos + text.length;
	    txtarea.selectionStart = strPos;
	    txtarea.selectionEnd = strPos;
	    txtarea.focus();
	    txtarea.scrollTop = scrollPos;
	}

	(function (jQuery, undefined){
		jQuery.fn.getCursorPosition = function(){
	        var el = jQuery(this).get(0);
	        var pos = 0;
	        if('selectionStart' in el){
	            pos = el.selectionStart;
	        } else if('selection' in document){
	            el.focus();
	            var Sel = document.selection.createRange();
	            var SelLength = document.selection.createRange().text.length;
	            Sel.moveStart('character', -el.value.length);
	            pos = Sel.text.length - SelLength;
	        }
	        return pos;
	    }
	})(jQuery);
	
</script>

</head>

<body>

	<h:form>

		<h:inputTextarea maxlength="100" cols="70" rows="10" value="#{canvasModalBean.commandEdit}"
			style="resize:none;border:1px solid;" id="commandText" />

		<br />
		<br />

		<a4j:region>
			<table width="100%" id="table">
				<tr style="vertical-align: top;">
					<td width="45%">
						<br /> 
						
						<rich:comboBox id="listCategories" value="#{canvasModalBean.list}" enableManualInput="false"
							width="200" listWidth="150" listHeight="200">
							<a4j:support event="onselect" action="#{canvasModalBean.changeFunctionsTextEditor}"
								reRender="listFunctions,btCompleteFunction" />
							<f:selectItems value="#{canvasModalBean.listItensTable}" />
						</rich:comboBox>
						
						<br />
						
						<rich:dataTable id="listFunctions" value="#{canvasModalBean.listFunctions}" var="item"
							style="border:1px solid;" width="100%" onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
							enableContextMenu="false" onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'">
	
							<rich:column style="border-bottom:0px;border-right:0px;">
								<f:facet name="header">
									<h:outputText value="#{messages.label_word}" />
								</f:facet>
								<a4j:commandLink id="btCompleteFunction" onclick="completeCommand('#{item[0]}');"
									onmouseover="addtooltip('#{item[3]}', event)" onmouseout="removetoottip()">
									<f:param name="nameFunctions" value="#{item[0]}" />
									<h:outputText value="#{item[0]}" />
								</a4j:commandLink>
							</rich:column>
	
							<rich:column style="border-bottom:0px;border-right:0px;">
								<f:facet name="header">
									<h:outputText value="#{messages.label_input}" />
								</f:facet>
								<h:outputText value="#{item[1]}" />
							</rich:column>
	
							<rich:column style="border-bottom:0px;border-right:0px;">
								<f:facet name="header">
									<h:outputText value="#{messages.label_return}" />
								</f:facet>
								<h:outputText value="#{item[2]}" />
							</rich:column>
	
						</rich:dataTable>
					</td>
	
					<td width="10%">
						<br />
						
						<rich:comboBox id="listCategoriesOperation" value="#{canvasModalBean.listOp}"
							enableManualInput="false" width="100" listWidth="150" listHeight="100">
							<a4j:support event="onselect" action="#{canvasModalBean.changeOperationTextEditor}"
								reRender="listOperation" />
							<f:selectItems value="#{canvasModalBean.listItensTableOperation}" />
						</rich:comboBox>
						
						<br />
						
						<rich:dataTable id="listOperation" value="#{canvasModalBean.listOperation}" var="item"
						style="border:1px solid;" width="100%" onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
						enableContextMenu="false" onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'">

							<rich:column style="border-bottom:0px;border-right:0px;">
								<f:facet name="header">
									<h:outputText value="#{messages.label_operation}" />
								</f:facet>
								<a4j:commandLink id="btCompleteFunction" onclick="completeCommand('#{item[0]}');"
									onmouseover="addtooltip('#{item[3]}', event)" onmouseout="removetoottip()">
									<f:param name="nameFunctions" value="#{item[0]}" />
									<h:outputText value="#{item[0]}" />
								</a4j:commandLink>
							</rich:column>
	
						</rich:dataTable>
					</td>
	
					<td width="45%">
					
					<br />
					<br />
					<br />
						
						<rich:dataTable id="listFields"	value="#{canvasModalBean.listFields}" var="item"
							style="border:1px solid;" width="100%" onRowClick="completeFilds" onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
							enableContextMenu="false" onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'">
	
							<rich:column style="border-bottom:0px;border-right:0px;">
								<f:facet name="header">
									<h:outputText value="#{messages.label_name}" />
								</f:facet>
								<a4j:commandLink id="btCompleteFilds"
									onclick="completeCommand('#{item.key}');">
									<f:param name="nameFilds" value="#{item.key}" />
									<h:outputText value="#{item.key}" />
								</a4j:commandLink>
							</rich:column>
	
							<rich:column style="border-bottom:0px;border-right:0px;">
								<f:facet name="header">
									<h:outputText value="#{messages.label_type}" />
								</f:facet>
								<h:outputText value="#{item.value}" />
							</rich:column>
	
						</rich:dataTable>
						
					</td>
				</tr>
			</table>
		</a4j:region>
		<br />

		<a4j:commandButton action="#{canvasModalBean.confirm}"
			value="#{messages.button_ok}"
			oncomplete="if(#{requestScope['msnError'] == null}){ #{rich:component('textEditorPanel')}.hide() };"
			reRender="command,tableInteraction, msnError, errorTable" />
			
		<span>&nbsp;&nbsp;</span>
		
		<h:commandButton value="#{messages.button_cancel}" type="button" onclick="#{rich:component('textEditorPanel')}.hide();"/>
			
		<span>&nbsp;&nbsp;</span>
		
		<a4j:commandButton action="#{canvasModalBean.checkTextEditor}" value="#{messages.button_check}" reRender="command,tableInteraction, msnError, errorTable" />

	</h:form>
	
</body>
</html>