<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j">

<script>
//<![CDATA[

	function completeCommand(text){
	    var txtarea = jQuery("[id$='commandText']");
	    var scrollPos = txtarea.scrollTop;
	    var strPos = 0;
	    strPos = txtarea.getCursorPosition();
	    var spaceAdd = 0;
	    var front = (txtarea.val().trim()).substring(0,strPos);
	    if(front.length > 0 && front.charAt(front.length -1) != " "){
	       front += " ";
	       spaceAdd += 1;
	    }
	    var back = (txtarea.val().trim()).substring(strPos,txtarea.val().length);
        if(back.length > 0 && back.charAt(back.length -1) != " "){
           back = " "+back;
           spaceAdd += 1;
        }
	    txtarea.val(front + text.trim() + back);


	    var regex = '\\(';
	    var pos = text.search(regex);
	    if(pos != -1){
		    strPos = strPos + pos+1+spaceAdd;
		}else{
			strPos = strPos + text.length+spaceAdd;
		}
	    
	    //txtarea.selectionStart = strPos;
	    //txtarea.selectionEnd = strPos;
	    //txtarea.focus();

	    txtarea.selectRange(strPos,strPos);
	    
	    txtarea.scrollTop = scrollPos;
	}

	(function (jQuery, undefined){
		jQuery.fn.getCursorPosition = function(){
	        var el = jQuery(this).get(0);
	        var pos = 0;
	        if('selectionStart' in el){
	            pos = el.selectionStart;
	        } else if('selection' in document){
	            el.focus();
	            var Sel = document.selection.createRange();
	            var SelLength = document.selection.createRange().text.length;
	            Sel.moveStart('character', -el.value.length);
	            pos = Sel.text.length - SelLength;
	        }
	        return pos;
	    }
	})(jQuery);

	(function (jQuery, undefined){
	jQuery.fn.selectRange = function(start, end) {
	    if(!end) end = start; 
	    return this.each(function() {
	        if (this.setSelectionRange) {
	            this.focus();
	            this.setSelectionRange(start, end);
	        } else if (this.createTextRange) {
	            var range = this.createTextRange();
	            range.collapse(true);
	            range.moveEnd('character', end);
	            range.moveStart('character', start);
	            range.select();
	        }
	    });
	}
	})(jQuery);
	
//]]>
</script>


	<h:form>
	<div id="canvasModalBeanTextEditor" style="width:100%; overflow: auto; height: 375px;" rendered="#{canvasModalBean.selEditor != null}" >

		<h:inputTextarea maxlength="100" cols="70" rows="10" value="#{canvasModalBean.selEditor.value}"
			style="resize:none;border:1px solid;" id="commandText" />

		<br />
		<br />

		<a4j:region>
			<table width="100%" id="table">
				<tr style="vertical-align: top;">
					<td width="45%">
						<br /> 
						<rich:comboBox id="listCategories" 
						    value="#{canvasModalBean.selEditor.selectedFunction}"
						    suggestionValues="#{canvasModalBean.selEditor.textEditorFunctionMenu}" 
						    enableManualInput="false"
							width="200" listWidth="150" listHeight="200">
							<a4j:support event="onselect" 
								reRender="listFunctions,btCompleteFunction" />
						</rich:comboBox>
						<br />
						
						<rich:extendedDataTable id="listFunctions" 
						    value="#{canvasModalBean.selEditor.edit.textEditorFunctions[canvasModalBean.selEditor.selectedFunction]}" 
						    var="item"
							style="border:1px solid;" width="100%" onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
							enableContextMenu="false" selectionMode="none"
							onRowMouseOut="this.style.backgroundColor='#{a4jSkin.rowBackgroundColor}'"
							rowClasses="even-row, odd-row">
	
							<rich:column style="border-bottom:0px;border-right:0px;">
								<f:facet name="header">
									<h:outputText value="#{messages.label_word}" />
								</f:facet>
								<a4j:commandLink id="btCompleteFunction" onclick="completeCommand('#{item[0]}');"
									onmouseover="addtooltip('#{item[3]}', event)" onmouseout="removetoottip()">
									<f:param name="nameFunctions" value="#{item[0]}" />
									<h:outputText value="#{item[0]}" />
								</a4j:commandLink>
							</rich:column>
	
							<rich:column style="border-bottom:0px;border-right:0px;">
								<f:facet name="header">
									<h:outputText value="#{messages.label_input}" />
								</f:facet>
								<h:outputText value="#{item[1]}" />
							</rich:column>
	
							<rich:column style="border-bottom:0px;border-right:0px;">
								<f:facet name="header">
									<h:outputText value="#{messages.label_return}" />
								</f:facet>
								<h:outputText value="#{item[2]}" />
							</rich:column>
	
						</rich:extendedDataTable>
					</td>
	
					<td width="10%">
						<br />
						<rich:comboBox id="listCategoriesOperation" 
					   	   value="#{canvasModalBean.selEditor.selectedOperation}"
						   suggestionValues="#{canvasModalBean.selEditor.textEditorOperationMenu}"
							enableManualInput="false" width="100" listWidth="150" listHeight="100">
							<a4j:support event="onselect"
								reRender="listOperation" />
						</rich:comboBox>
						<br />
						
						<rich:extendedDataTable id="listOperation" 
						value="#{canvasModalBean.selEditor.edit.textEditorOperations[canvasModalBean.selEditor.selectedOperation]}" 
						var="item"
						style="border:1px solid;" width="100%" onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
						enableContextMenu="false" selectionMode="none"
						onRowMouseOut="this.style.backgroundColor='#{a4jSkin.rowBackgroundColor}'"
						rowClasses="even-row, odd-row">

							<rich:column style="border-bottom:0px;border-right:0px;">
								<f:facet name="header">
									<h:outputText value="#{messages.label_operation}" />
								</f:facet>
								<a4j:commandLink id="btCompleteFunction" onclick="completeCommand('#{item[0]}');"
									onmouseover="addtooltip('#{item[3]}', event)" onmouseout="removetoottip()">
									<f:param name="nameFunctions" value="#{item[0]}" />
									<h:outputText value="#{item[0]}" />
								</a4j:commandLink>
							</rich:column>
	
						</rich:extendedDataTable>
					</td>
	
					<td width="45%">
					
					<br />
					<br />
					<br />
						
						<rich:extendedDataTable id="listFields"	value="#{canvasModalBean.selEditor.edit.textEditorFieldsEntry}" var="item"
							style="border:1px solid;" width="100%" onRowClick="completeFilds" onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
							enableContextMenu="false" selectionMode="none"
							onRowMouseOut="this.style.backgroundColor='#{a4jSkin.rowBackgroundColor}'"
							rowClasses="even-row, odd-row">
	
							<rich:column style="border-bottom:0px;border-right:0px;">
								<f:facet name="header">
									<h:outputText value="#{messages.label_name}" />
								</f:facet>
								<a4j:commandLink id="btCompleteFilds"
									onclick="completeCommand('#{item.key}');">
									<f:param name="nameFilds" value="#{item.key}" />
									<h:outputText value="#{item.key}" />
								</a4j:commandLink>
							</rich:column>
	
							<rich:column style="border-bottom:0px;border-right:0px;">
								<f:facet name="header">
									<h:outputText value="#{messages.label_type}" />
								</f:facet>
								<h:outputText value="#{item.value}" />
							</rich:column>
	
						</rich:extendedDataTable>
						
					</td>
				</tr>
			</table>
		</a4j:region>
		<br />

		<a4j:commandButton action="#{canvasModalBean.selEditor.confirmValueAndCopy}"
		    styleClass="greenButton"
			value="#{messages.button_ok}"
			oncomplete="if(#{requestScope['msnError'] == null}){ #{rich:component('textEditorPanel')}.hide() };"
			reRender="command,tableInteraction, msnError, errorTable" />
			
		<h:commandButton styleClass="greenButton" value="#{messages.button_cancel}" type="button" onclick="#{rich:component('textEditorPanel')}.hide();"/>
			
		<a4j:commandButton  styleClass="greenButton" action="#{canvasModalBean.selEditor.checkTextEditor}" value="#{messages.button_check}" reRender="command,tableInteraction, msnError, errorTable" />

	</div>
	</h:form>
	
</ui:composition>
