<html>
<head>

<link rel="stylesheet" href="css/table-style.css" type="text/css" />
<link href="css/bootstrap.css" rel="stylesheet" type="text/css" media="all" />
<link href="css/apache-maven-fluido-1.3.1.min.css" rel="stylesheet" type="text/css" media="all" />

<script src="javascript/jquery.min.js"></script>
<script src="javascript/bootstrap.min.js"></script>
<script src="javascript/analytics.js"></script>

</head>
<body>

<script>

$(document).ready(function() {

	$('#menudiv').load('menu.html');

	if(localStorage.getItem("textToSearch") !== null){
		doSearch(JSON.stringify({software: 'Redsqirl', filter: localStorage.getItem("textToSearch") }));
		$("#filterSearch").val(localStorage.getItem("textToSearch"));
		localStorage.removeItem("textToSearch");
	}else{
		doSearch(JSON.stringify(jQuery('#search').serializeArray().reduce(function(a, x) { a[x.name] !== undefined ? a[x.name] = '' : a[x.name] = x.value; return a; }, {})));
	}

	setTimeout(function(){
		checkMenu();
	},200);
});

function doSearch(value) {

//console.log(JSON.stringify(jQuery('#search').serializeArray().reduce(function(a, x) { a[x.name] = x.value; return a; }, {})));

	jQuery.ajax({
		method: "POST",
		dataType: "json",
		contentType: "application/json; charset=utf-8",
		url: getPropreties.url+"allpackages",
		data: value
	}).then(function(data) {

		data = removeDuplicate(data, 'name');

		jQuery.each(data, function(i) {

			jQuery(".packageList").append("<div class='packageItem' ><img height='100' width='100' class='image' src='data:image/jpg;base64,"+ data[i].imgBytes +"' ><div class='type'>"+ (data[i].type == 'package' ? "<img src='images/verified_package.png' style='height:20px;margin-top:10px;' title='package' />" : "<img src='images/new_module.gif' style='height:20px;margin-top:10px;' title='model' />")  + "</div><div class='title'>" + data[i].name + " </div>"+ (getsessionToken() !== null ? "<input type='submit' class='contentbutton' value='Request Key' onclick='event.preventDefault();installationPopUp("+ data[i].id +","+ data[i].idVersion +");' style='position:relative;margin-left:5px;top:40px;z-index:2;' data-toggle='modal' data-target='#modalModuleDetail' >" : "<input type='submit' class='contentbutton' value='Request Key' style='position:relative;margin-left:5px;top:40px;z-index:2;opacity:0.4;' disabled>") +" <div class='license'>" + data[i].tags + "</div> <div class='license' style='margin-right:0px;'>" + data[i].price + "</div> <div class='shortDescription'>"+ data[i].shortDescription +"</div> <div><a href='moduleDetail.html?id="+ data[i].id +"'><img src='images/more_details.png' style='position:relative;float:right;bottom:-20px;height:20px;padding-right:5px;' title='More details' /></a></div> </div>");

		});
	});

}

function reload() {
	jQuery(".packageList").empty();
	doSearch(JSON.stringify(jQuery('#search').serializeArray().reduce(function(a, x) { a[x.name] !== undefined ? a[x.name] = '' : a[x.name] = x.value; return a; }, {})));
}


</script>

<div id="menudiv"></div>

<div class="mainContent" id="mainPanel">

<form id="search">

<input type="hidden" value="Redsqirl" name="software">

<div class="searchBar">

<input type="text" placeholder="Search" style="width:420px;" name="filter" id="filterSearch" >

<input type="checkbox" name="type" value="package" id="r1" onclick="reload();" style="margin-bottom: 8px;" /><label for="r1">Package</label>
<input type="checkbox" name="type" value="model" id="r2" onclick="reload();" style="margin-bottom: 8px;" /><label for="r2">Model</label>


<input type="submit" class="contentbutton" value="Search" onclick="event.preventDefault();reload();" style="position:relative; bottom:5px;" >

</div>

</form>

<div class="packageList">
<span id="out">
</span>
</div>

</div>
<p style="float: right; padding: 10px 145px 0px 0px;" >Copyright &copy; 2016 <a href="http://www.redsqirl.com">Red Sqirl</a>. All rights reserved.</p>

</body>
</html>
