<html>
<head>

<link rel="stylesheet" href="css/table-style.css" type="text/css" />
<link href="css/bootstrap.css" rel="stylesheet" type="text/css" media="all" />
<link href="css/apache-maven-fluido-1.3.1.min.css" rel="stylesheet" type="text/css" media="all" />

<script src="javascript/jquery.min.js"></script>
<script src="javascript/bootstrap.min.js"></script>
<script src="javascript/analytics.js"></script>

</head>
<body>

<script>

$(document).ready(function() {

	$('#menudiv').load('menu.html');

	if(localStorage.getItem("textToSearch") !== null){
		doSearch(JSON.stringify({software: 'Redsqirl', filter: localStorage.getItem("textToSearch") }));
		$("#filterSearch").val(localStorage.getItem("textToSearch"));
		localStorage.removeItem("textToSearch");
	}else{
		doSearch(JSON.stringify(jQuery('#search').serializeArray().reduce(function(a, x) { a[x.name] !== undefined ? a[x.name] = '' : a[x.name] = x.value; return a; }, {})));
	}

	setTimeout(function(){
		checkMenu();
	},200);
});

function doSearch(value) {

//console.log(JSON.stringify(jQuery('#search').serializeArray().reduce(function(a, x) { a[x.name] = x.value; return a; }, {})));

	jQuery.ajax({
		method: "POST",
		dataType: "json",
		contentType: "application/json; charset=utf-8",
		url: getPropreties.url+"allpackages",
		data: value
	}).then(function(data) {

		data = removeDuplicate(data, 'name');

		jQuery.each(data, function(i) {

			jQuery(".packageList").append("<div class='packageItem' onclick='goToUrl(event, this);'><img height='100' width='100' class='image' src='data:image/jpg;base64,"+ data[i].imgBytes +"' ><div class='type'>"+ data[i].type + "</div><div class='title'><a class='hiddenLink' href='moduleDetail.html?id="+ data[i].id +"'></a>" + data[i].name + " </div><div class='license'>" + data[i].tags + "</div></div>");

		});
	});

}

function reload() {
	jQuery(".packageList").empty();
	doSearch(JSON.stringify(jQuery('#search').serializeArray().reduce(function(a, x) { a[x.name] !== undefined ? a[x.name] = '' : a[x.name] = x.value; return a; }, {})));
}

function goToUrl(event, component){
	event.preventDefault();
	var target = jQuery(event.target);
	if(!target.is("input")){
		window.location = jQuery(component).find("a.hiddenLink").attr("href");
	}
	return false;
}

</script>

<div id="menudiv"></div>

<div class="mainContent" id="mainPanel">

<form id="search">

<input type="hidden" value="Redsqirl" name="software">

<div class="searchBar">

<input type="text" placeholder="Search" style="width:420px;" name="filter" id="filterSearch" >

<input type="checkbox" name="type" value="package" id="r1" onclick="reload();" /><label for="r1">Package</label>
<input type="checkbox" name="type" value="model" id="r2" onclick="reload();" /><label for="r2">Model</label>


<input type="submit" class="contentbutton" value="Search" onclick="event.preventDefault();reload();" >

</div>

</form>

<div class="packageList">
<span id="out">
</span>
</div>

</div>
<p style="float: right; padding: 10px 145px 0px 0px;" >Copyright &copy; 2016 <a href="http://www.redsqirl.com">Red Sqirl</a>. All rights reserved.</p>

</body>
</html>
