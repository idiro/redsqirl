<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"   
      xmlns:ui="http://java.sun.com/jsf/facelets"   
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:p="http://xmlns.jcp.org/jsf/passthrough">
      
    <h:head>
   		<link rel="stylesheet" href="#{facesContext.externalContext.requestContextPath}/css/table-style.css" />
   		<script src='js/redsqirl-pck-manager.js' type="text/javascript"></script>
		<script src='js/jquery-1.9.1.js' type="text/javascript"></script>
    </h:head> 
      
	<h:body>
	
		<a4j:status name="loadingScreen"
		    onstart="#{rich:component('loadingPopupPanel')}.show(); return false;"
		    onstop="#{rich:component('loadingPopupPanel')}.hide(); return false;">
		</a4j:status>
		
		<rich:popupPanel id="loadingPopupPanel" moveable="false" 
			styleClass="loading-panel">
			<div style="width:180px;margin:auto;margin-top:55px;margin-bottom:10px;">
				<h:graphicImage value="img/ajax-loader.gif"/>
			</div>
		    <h:outputText value="Loading..." 
		    	style="font-size:20px;text-align:center;"/>
		</rich:popupPanel>
		
		<h:panelGroup class="leftBar" layout="block">
			<h:outputText value="Home" /><br/>
			<h:outputText value="Red Sqirl" /><br/>
			<h:outputText value=">Search" /><br/>
			<h:outputText value=">My installations" rendered="#{loginBean.loggedIn}" />
		</h:panelGroup>
		
		<h:panelGroup class="topBar" layout="block">
			<h:form>
				<h:commandButton value="Register" rendered="#{!loginBean.loggedIn}">
					<rich:componentControl target="registerPopup" operation="show" />
				</h:commandButton>
					    
				<h:commandButton value="Login" rendered="#{!loginBean.loggedIn}">
					<rich:componentControl target="loginPopup" operation="show" />
				</h:commandButton>
					    
				<h:commandButton value="Logout" rendered="#{loginBean.loggedIn}"
					action="#{loginBean.doLogout}"/>
			</h:form>
		</h:panelGroup>
		
		<h:panelGroup class="mainContent" layout="block">
	 	<a4j:outputPanel id="out">
		 	<h:form>
	    		<h:panelGroup rendered="#{analyticalStoreBean.page == 'index'}">
	    		
		    		<h:outputText value="Red Sqirl Package Manager" style="font-weight:bold" />
				 	<br/>
				 	<br/>
				 	<h:outputText value="Welcome to Red Sqirl Package manager. The website aims to gather all the official package available on the Red Sqirl platform."/><br/>
	 	
	 				<h:panelGroup layout="block" class="searchBar">
		 				<h:outputText value="Search:"/>
		 				<h:inputText value="#{analyticalStoreBean.searchValue}"/>
		 				<h:outputText value="Only Free"/>
		 				<h:selectBooleanCheckbox value="#{analyticalStoreBean.onlyFree}" />
		 				<a4j:commandButton value="Search" render="out"/>
		 			</h:panelGroup>
	 				
	 				<h:panelGroup layout="block" class="packageList">
		 				<a4j:repeat value="#{analyticalStoreBean.allPackageList}" var="pck">
		 					<div class="packageItem" onclick="goToUrl(event, this);">
		 						<h:graphicImage value="/images/#{pck.name}.gif" width="100" height="100" class="image"/>
		 						<h:panelGroup layout="block" class="title">
			 						<a4j:commandLink styleClass="hiddenLink" action="#{analyticalStoreBean.selectPage}" execute="@this" render="out">
				    					<a4j:param value="#{pck.id}" assignTo="#{analyticalStoreBean.selectedPackageId}" />  
				    				</a4j:commandLink>
				    				 <h:outputText value="#{pck.name}"/>
				    			</h:panelGroup>
				    			<h:panelGroup layout="block" class="license">
				    				<h:outputText value="#{pck.license}  "/>
				    			</h:panelGroup>
				    			<h:panelGroup layout="block" class="description">
				    				<h:outputText value="#{pck.shortDescription}"/>
				    			</h:panelGroup>
		 					</div>
		 				</a4j:repeat>
		 			</h:panelGroup>
	 				
				</h:panelGroup>
				
				<h:panelGroup rendered="#{analyticalStoreBean.page == 'detail'}">
					<a4j:commandLink value="Back" action="#{analyticalStoreBean.selectPage}" render="out" execute="@this"
						rendered="#{analyticalStoreBean.page == 'detail'}"/> <br />
					
					<h:panelGrid id="panel" columns="2">
						<h:dataTable value="#{analyticalStoreBean.selectedPackageList}" var="pck"
			    			styleClass="order-table"
			    			headerClass="order-table-header"
			    			rowClasses="order-table-odd-row,order-table-even-row">
			    			<h:column>
			    				<f:facet name="header">Version</f:facet>
			    				<a4j:commandLink value="#{pck.version}" action="#{analyticalStoreBean.selectPage}" execute="@this" render="out">
			    					<a4j:param value="#{pck.version}" assignTo="#{analyticalStoreBean.selectedVersion}" /> 
			    				</a4j:commandLink>
			    			</h:column>
			    		</h:dataTable>
			    		<h:panelGroup>
				    		<h:outputText value="Date: #{analyticalStoreBean.selectedPackage.packageDate}" /><br/>
				    		<h:outputText value="License: #{analyticalStoreBean.selectedPackage.license}" /><br/>
				    		<h:outputText value="Version: #{analyticalStoreBean.selectedPackage.version}" /><br/>
				    		<h:outputText value="Price: #{analyticalStoreBean.selectedPackage.price}" /><br/>
				    		<h:commandButton value="Download"></h:commandButton>
			    		</h:panelGroup>
		    		</h:panelGrid>
				</h:panelGroup>
			</h:form>
		
	    </a4j:outputPanel>
	    </h:panelGroup>
	    
	    <rich:popupPanel id="registerPopup" modal="true" resizeable="false" onmaskclick="#{rich:component('registerPopup')}.hide()"
	    	width="450" height="300">
	        <f:facet name="header">
	            <h:outputText value="Register" />
	        </f:facet>
	        <f:facet name="controls">
	            <h:outputLink value="#" onclick="#{rich:component('registerPopup')}.hide(); return false;">
	                X
	            </h:outputLink>
	        </f:facet>
		    <h:form>
		    	<h:outputText value="First Name" class="popupCentro"/>
				<h:inputText value="#{userBean.firstName}" style="width:400px;"/>
				
				<h:outputText value="Last Name" class="popupCentro"/>
				<h:inputText value="#{userBean.lastName}" style="width:400px;"/>
				
				<h:outputText value="Email" class="popupCentro"/>
				<h:inputText value="#{userBean.email}" style="width:400px;"/>
				
				<h:outputText value="Company" class="popupCentro"/>
				<h:inputText value="#{userBean.company}" style="width:400px;"/>
				
				<h:outputText value="Password" class="popupCentro"/>
				<h:inputText value="#{userBean.password}" style="width:400px;"/>
				
				<a4j:commandButton value="Register" action="#{userBean.createUser}"
					oncomplete="if (#{!facesContext.validationFailed}){#{rich:component('registerPopup')}.hide();}">
				</a4j:commandButton>
		    </h:form>
	    </rich:popupPanel>
	    
	    <rich:popupPanel id="loginPopup" modal="true" resizeable="false" onmaskclick="#{rich:component('loginPopup')}.hide()"
	    	width="450" height="300">
	        <f:facet name="header">
	            <h:outputText value="Register" />
	        </f:facet>
	        <f:facet name="controls">
	            <h:outputLink value="#" onclick="#{rich:component('loginPopup')}.hide(); return false;">
	                X
	            </h:outputLink>
	        </f:facet>
		    <h:form>
		    	<h:outputText value="Email" class="popupCentro"/>
				<h:inputText value="#{loginBean.email}" style="width:400px;"/>
				
				<h:outputText value="Password" class="popupCentro"/>
				<h:inputText value="#{loginBean.password}" style="width:400px;"/>
				
				<a4j:commandButton value="Login" action="#{loginBean.doLogin}"
					oncomplete="if (#{!facesContext.validationFailed}){#{rich:component('loginPopup')}.hide();}">
				</a4j:commandButton>
		    </h:form>
		    	
		    
	    </rich:popupPanel>
    
	</h:body>
			
</html>