<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ui="http://java.sun.com/jsf/facelets">

<a4j:loadBundle basename="MessagesResources" var="messages" />
        
<h:form>
        
    <div id="domMessageDivModalSettings" style="display: none;">
        <img src="../image/icons/waiting.gif" />
    </div>

    <a4j:status onstart="jQuery.blockUI({ message: jQuery('#domMessageDivModalSettings') });"
    	onerror="jQuery.unblockUI();" onsuccess="jQuery.unblockUI();" onstop="jQuery.unblockUI();" />
    <a4j:jsFunction name="storeNewSettings" action="#{settingsBean.storeNewSettings}"
    	oncomplete="jQuery.unblockUI();" reRender="userSettingsTabPanel,sysSettingsTabPanel" />
    <a4j:jsFunction name="calcSettings" action="#{settingsBean.calcSettings}"
    	oncomplete="jQuery.unblockUI();" reRender="userSettingsTabPanel,sysSettingsTabPanel" />
            
    <div style="width:100%;height: 550px;" >
                
        <rich:tabPanel id="settingsTabPanel" style="border:none;" switchType="ajax">
        
            <rich:tab label="#{messages.label_tab_usersetting}" style="border:none;border-collapse:collapse;" >
                <rich:panel id="userSettingsTabPanel" style="border:1px solid black;padding-left:5px; overflow: auto; height:465px;">
                    <a4j:repeat value="#{settingsBean.userSettings}" var="setting" >
                        <h:outputText value="#{setting[1]}" title="#{setting[2]}" />
                        <br />
                        <h:inputText value="#{setting[3]}" size="100" />
                        <br />
                        <br />
                    </a4j:repeat>
                    
                     <a4j:commandLink title="#{messages.label_add_new_line}" oncomplete="#{rich:component('userNewSettings')}.show();" 
                     	rendered="#{settingsBean.admin}" >
		            	<img id="tableInteractionBtAdd" src="../image/icons/button-plus-small.gif" class="btConfigureFooter" />
		            </a4j:commandLink>
                    
                </rich:panel>
                
                <h:panelGrid columns="3">
                    <a4j:commandButton styleClass="greenButton"
                        value="#{messages.button_cancel}" type="button" reRender="errorTable" 
                        onclick="calcSettings();#{rich:component('modalSettings')}.hide();" />
                    <a4j:commandButton styleClass="greenButton" 
                        value="#{messages.button_apply}" reRender="msnError" 
                        onclick="storeNewSettings();" />
                    <a4j:commandButton styleClass="greenButton" 
                        value="#{messages.button_ok}" reRender="msnError, errorTable" 
                        onclick="storeNewSettings()"
                        oncomplete="#{rich:component('modalSettings')}.hide();" />
                </h:panelGrid>
            </rich:tab>
            
            <rich:tab label="#{messages.label_tab_syssetting}" >
            
                <rich:panel id="sysSettingsTabPanel" style="border:1px solid black;padding-left:5px;overflow: auto;height:465px;">
                
                    <a4j:repeat value="#{settingsBean.sysSettings}" var="setting" >
                        <h:outputText value="#{setting[1]}" title="#{setting[2]}" />
                        <br />
                        <h:inputText value="#{setting[3]}" size="100" disabled="#{not settingsBean.admin}" />
                        <br />
                        <br />
                    </a4j:repeat>
                    
                     <a4j:commandLink title="#{messages.label_add_new_line}" oncomplete="#{rich:component('sysNewSettings')}.show();" 
                     	rendered="#{settingsBean.admin}" >
		            	<img id="tableInteractionBtAdd" src="../image/icons/button-plus-small.gif" class="btConfigureFooter" />
		            </a4j:commandLink>
			            
                </rich:panel>
                
                <h:panelGrid columns="3">
                    <a4j:commandButton styleClass="greenButton"
                        value="#{messages.button_cancel}" type="button" reRender="errorTable" 
                        onclick="calcSettings();#{rich:component('modalSettings')}.hide();" />
                    <a4j:commandButton styleClass="greenButton" 
                        value="#{messages.button_apply}" reRender="msnError" 
                        onclick="storeNewSettings()" />
                    <a4j:commandButton styleClass="greenButton" 
                        value="#{messages.button_ok}" reRender="msnError, errorTable" 
                        onclick="storeNewSettings()"
                        oncomplete="#{rich:component('modalSettings')}.hide()" />
                </h:panelGrid>
                
            </rich:tab>
        </rich:tabPanel>
        
    </div>
    
</h:form>

	<rich:modalPanel id="userNewSettings" width="500" height="300" style="overflow:auto;" resizeable="false" >
		
		<h:form>
		
			<f:facet name="header">
				<h:outputText value='#{messages.label_add_new_line}' />
			</f:facet>
		
			<h:panelGrid columns="2">
			
				<h:outputText value="#{messages.label_name}" class="formLabel" />
				<h:inputText value="#{settingsBean.nameSettings}" style="width:400px;" onkeypress="return enableEnterKey(event, 'btAddNewLineUserSettings');" />
				
				<h:outputText value="#{messages.label_title_key}" class="formLabel" />
				<h:inputText value="#{settingsBean.titleSettings}" style="width:400px;" onkeypress="return enableEnterKey(event, 'btAddNewLineUserSettings');" />
				
				<h:outputText value="#{messages.label_value}" class="formLabel" />
				<h:inputText value="#{settingsBean.valueSettings}" style="width:400px;" onkeypress="return enableEnterKey(event, 'btAddNewLineUserSettings');" />
				
			</h:panelGrid>
					
			<br/><br/>
	           
        	<a4j:commandButton id="btAddNewLineUserSettings" value="#{messages.button_ok}" action="#{settingsBean.addNewLineUserSettings}" 
           		reRender="userSettingsTabPanel,sysSettingsTabPanel" oncomplete="#{rich:component('userNewSettings')}.hide();" />
           
            <a4j:commandButton value="#{messages.button_cancel}" oncomplete="#{rich:component('userNewSettings')}.hide();" />
           
    	</h:form>

	</rich:modalPanel>
	
	<rich:modalPanel id="sysNewSettings" width="500" height="300" style="overflow:auto;" resizeable="false" >
		
		<h:form>
		
			<f:facet name="header">
				<h:outputText value='#{messages.label_add_new_line}' />
			</f:facet>
		
			<h:panelGrid columns="2">
			
				<h:outputText value="#{messages.label_name}" class="formLabel" />
				<h:inputText value="#{settingsBean.nameSettings}" style="width:400px;" onkeypress="return enableEnterKey(event, 'btAddNewLineSysSettings');" />
				
				<h:outputText value="#{messages.label_title_key}" class="formLabel" />
				<h:inputText value="#{settingsBean.titleSettings}" style="width:400px;" onkeypress="return enableEnterKey(event, 'btAddNewLineSysSettings');" />
				
				<h:outputText value="#{messages.label_value}" class="formLabel" />
				<h:inputText value="#{settingsBean.valueSettings}" style="width:400px;" onkeypress="return enableEnterKey(event, 'btAddNewLineSysSettings');" />
				
			</h:panelGrid>
					
			<br/><br/>
	           
        	<a4j:commandButton id="btAddNewLineSysSettings" value="#{messages.button_ok}" action="#{settingsBean.addNewLineSysSettings}" 
           		reRender="userSettingsTabPanel,sysSettingsTabPanel" oncomplete="#{rich:component('sysNewSettings')}.hide();" />
           
            <a4j:commandButton value="#{messages.button_cancel}" oncomplete="#{rich:component('sysNewSettings')}.hide();" />
           
    	</h:form>

	</rich:modalPanel>

    
</ui:composition>