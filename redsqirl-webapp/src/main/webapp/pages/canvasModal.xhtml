<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ui="http://java.sun.com/jsf/facelets">

<a4j:loadBundle basename="MessagesResources" var="messages" />
        
<script>
    var minSize = true;
    function toggleTableSize(){
        if(minSize){
            //alert("hide all: "+minSize);
            //alert("canvasModalHeader");
            jQuery("#canvasModalHeader").hide();
            jQuery('[id$="panelBtCanvasModal"]').hide();
            
            //alert("canvasModalInteractionHeader_");
            jQuery('[id^="canvasModalInteractionHeader_"]').hide();
            //alert("input");
            if(jQuery('[id^="inputInteractionRegion"]')){
                jQuery('[id^="inputInteractionRegion"]').hide();
            }
            //alert("list");
            if(jQuery('[id^="listInteractionRegion"]')){
                jQuery('[id^="listInteractionRegion"]').hide();
            }
            //alert("append");
            if(jQuery('[id^="appendListInteractionRegion"]')){
                jQuery('[id^="appendListInteractionRegion"]').hide();
            }
            //alert("browser");
            if(jQuery('[id^="browserInteractionRegion"]')){
                jQuery('[id^="browserInteractionRegion"]').hide();
            }
            //alert("text");
            if(jQuery('[id^="textEditorInteractionRegion"]')){
                jQuery('[id^="textEditorInteractionRegion"]').hide();
            }
            //alert("div");
            jQuery('[id$="quickNavigation"]').hide();
            jQuery("#divTableInteraction").css("height","390");
        }else{
            //alert("show all: "+minSize);
            
            //alert("canvasModalHeader");
            jQuery("#canvasModalHeader").show();
            jQuery('[id$="panelBtCanvasModal"]').show();
            //alert("canvasModalInteractionHeader_");
            jQuery('[id^="canvasModalInteractionHeader_"]').show();
            //alert("input");
            if(jQuery('[id^="inputInteractionRegion"]')){
                jQuery('[id^="inputInteractionRegion"]').show();
            }
            //alert("list");
            if(jQuery('[id^="listInteractionRegion"]')){
                jQuery('[id^="listInteractionRegion"]').show();
            }
            //alert("append");
            if(jQuery('[id^="appendListInteractionRegion"]')){
                jQuery('[id^="appendListInteractionRegion"]').show();
            }
            //alert("browser");
            if(jQuery('[id^="browserInteractionRegion"]')){
                jQuery('[id^="browserInteractionRegion"]').show();
            }
            //alert("text");
            if(jQuery('[id^="textEditorInteractionRegion"]')){
                jQuery('[id^="textEditorInteractionRegion"]').show();
            }
            //alert("div");
            jQuery('[id$="quickNavigation"]').show();
            jQuery("#divTableInteraction").css("height","220px");
        }
        minSize= !minSize;
        //alert("new value: "+minSize);
    }
    
    function createOptionTitles() {
         //alert('createOptionTitles');
         jQuery('[id$="quickNavigation"]').hide();
         var inputs =  jQuery('[id$="quickNavigation"] input[type=radio]');
         //alert(inputs);
         inputs.each(function (index){
             //alert(index);
             var label = jQuery(this).siblings('label').text();
             // For debugging purposes...
             //alert(index + ': ' + label);
             jQuery(this).attr('title',label);
             jQuery(this).siblings('label').text('');
             
         });
         if(inputs.length > 1){
            jQuery('[id$="quickNavigation"]').show();
         }
    }

    function blockComoBoxNumberRows() {
    	jQuery('#displayTableComboNumberRowsDiv').block({
        	message: '<img height="20px" src="../image/icons/waiting.gif" />'
        });
    }

    function unBlockComoBoxNumberRows() {
    	jQuery('#displayTableComboNumberRowsDiv').unblock();
    }

    function blockSource() {
    	jQuery('#canvasModalDiv').block({
        	message: '<img src="../image/icons/waiting.gif" />'
        });
    }

    function unBlockSource() {
    	jQuery('#canvasModalDiv').unblock();
    }

</script>
        
    <div id="domMessageDivModal" style="display: none;">
        <img src="../image/icons/waiting.gif" />
    </div>
        
<h:form>
     
    <a4j:jsFunction name="reLoadTabs" reRender="browserTableData" oncomplete="unBlockSource();" />
    <a4j:jsFunction name="reLoadDisplayTable" reRender="displayTable,displayTableNumberRows, displayTableNumberRowsPanelGroup" action="#{canvasModalBean.outputTab.displayOutput}" >
    	<a4j:actionparam name="outputName" value="#{canvasModalBean.outputTab.outputFormList[0].name}" />
    	<a4j:actionparam name="resetMaxRows" value="Y" />
    </a4j:jsFunction>
    
    <a4j:region>
    	<a4j:jsFunction name="openHeaderEditorPanel" action="#{canvasModalBean.openHeaderEditorPanel}" 
    		oncomplete="#{rich:component('headerEditor')}.show(); setTimeout(function(){ startHeaderEditor(); }, 500); " reRender="canvasModalHeaderEditor">
			<a4j:actionparam name="idInteraction" value="#{interCur.id}"/>
		</a4j:jsFunction>
    </a4j:region>
     
    <a4j:region>
        <a4j:jsFunction name="closeCanvasModal" 
                action="#{canvasModalBean.closeCanvasModal}" />
        <a4j:jsFunction name="closeDynamicForm" 
                data="#{canvasModalBean.idGroup}"
                oncomplete="closeCanvasModal();#{rich:component('canvasModalPanel')}.hide();if(#{canvasModalBean.elementToUpdate}){updateOutputStatus(data);cloneAfterUpdateElement();}else{removeCloneWorkflow(cloneCommandUpdateElementBuffer);if(#{canvasModalBean.loadMainWindow}){updateOutputStatus(data);}}" />
    </a4j:region>
    
    <a4j:region>
        <a4j:jsFunction name="openHelpTextEditorModal" 
                action="#{canvasModalBean.openHelpTextEditorModal}" value=". . ."  
                reRender="commandText,listFields,listFunctions,comboboxListCategories,listOperation,comboboxListCategoriesOperation,errorTable,msnError" 
                oncomplete="mountComboboxTextEditor('#{canvasModalBean.selEditor.textEditorFunctionMenuString}','#{canvasModalBean.selEditor.textEditorOperationMenuString}');#{rich:component('textEditorPanel')}.show();" style="float:right;margin-right:62px;height:46px;">
                    <a4j:actionparam name="idInteraction" value="#{interCur.id}"/>
                    <a4j:actionparam  name="rowKey" value="#{rowNb}"/>
                    <a4j:actionparam  name="column" value="#{column}"/>
        </a4j:jsFunction>
    </a4j:region>
                
    <a4j:region>
        <a4j:status onstart="jQuery.blockUI({ message: jQuery('#domMessageDivModal') });"
        	onerror="jQuery.unblockUI();" onsuccess="jQuery.unblockUI();" onstop="jQuery.unblockUI();" />
                    
        <a4j:jsFunction name="openModalOutputBrowser" action="#{canvasModalBean.outputTab.updateDFEOutputTable}" 
        	reRender="modalOutputBrowser" oncomplete="mountComboboxExtensionsFilesystem();#{rich:component('modalOutputBrowser')}.show();" >
        	<a4j:actionparam name="openOutputData" assignTo="#{canvasModalBean.outputTab.fileSystem.openOutputData}"/>
        </a4j:jsFunction>
        
        <a4j:jsFunction name="openModalOutputBrowserCM" reRender="modalOutputBrowser" oncomplete="mountComboboxExtensionsFilesystem();#{rich:component('modalOutputBrowser')}.show();" >
        	<a4j:actionparam name="openOutputData" assignTo="#{canvasModalBean.outputTab.fileSystem.openOutputData}"/>
        </a4j:jsFunction>
    </a4j:region>
    
    <a4j:region>
        <a4j:status onstart="jQuery.blockUI({ message: jQuery('#domMessageDivModal') });"
        	onerror="jQuery.unblockUI();" onsuccess="jQuery.unblockUI();" onstop="jQuery.unblockUI();" />
                    
        <a4j:jsFunction name="resetCurrentOutputBrowser" action="#{canvasModalBean.outputTab.resetNameOutput}" oncomplete="updateOutputBrowser()"/>
        <a4j:jsFunction name="updateOutputBrowser" action="#{canvasModalBean.outputTab.updateDFEOutputTable}" oncomplete="reLoadTabs();" />
    </a4j:region>
            
    <div style="width:100%;height:100%;overflow:hidden;" id="canvasModalDiv" >
                
        <rich:tabPanel id="canvasModalTabPanel" style="border:none;width:100%;" switchType="ajax" selectedTab="#{canvasModalBean.selectedTab}" >
        
        <a4j:status onstart="jQuery.blockUI({ message: jQuery('#domMessageDivModal') });"
            onerror="jQuery.unblockUI();" onsuccess="jQuery.unblockUI();"
            onstop="jQuery.unblockUI();" />
        
        <rich:tab id="confTabCM" 
            label="#{messages.label_dynamic_configuration}" 
            style="border:none;border-collapse:collapse;width:100%;"
            rendered="#{canvasModalBean.listPageSize != 0}" 
            oncomplete="createOptionTitles();if(#{canvasModalBean.sourceNode}){resetCurrentOutputBrowser();}">
            
        <rich:panel id="panelDynamicForm" style="border:none;overflow:auto;height:465px;width:100%;padding-left: 3px;padding-right: 3px;" >
            
            <span id="canvasModalHeader">
            
                <table style="width:100%; height:100% !important;display:block;">
                    <tbody style="width:100%">
                        <tr style="width:100%;right:0px;position:relative;">
                            <td style="width:50px;padding:0px;margin:0px;" >
                                <img src="#{canvasModalBean.pathImage}"/>
                            </td>
                            <td style="width:700px;padding:0px;margin:0px;">
                                <h1><h:outputText value="#{canvasModalBean.pageTitle}"/></h1>
                            </td>
                        </tr>
                    </tbody>
                </table>
                
                <p>
                	<h:graphicImage value="../image/icons/question_mark.gif" 
                	   onmouseover="addtooltip('#{canvasModalBean.pageTextTip}', event)" onmouseout="removetoottip()" styleClass="questionMarkIcon" rendered="#{canvasModalBean.pageTextTip != null}" />
                	<h:outputText value="#{canvasModalBean.pageLegend}"/>
                </p>
            
            </span>
        
            <a4j:repeat value="#{canvasModalBean.inters}" var="interCur" rowKeyVar="interCurIdx" id="dynamicFormInteraction" >
                
                <span id="canvasModalInteractionHeader_#{interCurIdx}">
                    
                    <h2><h:outputText value="#{interCur.name}"/></h2>
                    
                    <p>
                    	<h:graphicImage value="../image/icons/question_mark.gif" onmouseover="addtooltip('#{interCur.textTip}', event)" onmouseout="removetoottip()" styleClass="questionMarkIcon" rendered="#{interCur.textTip != null}"/>
                    	<h:outputText value="#{interCur.legend}"/>
                    </p>
                    
                </span>
                
                <!-- input -->
                
                <a4j:region id="inputInteractionRegion" rendered="#{interCur.displayType == 'input'}">
                    <span id="inputInteractionRegion_#{interCurIdx}">
                        <h:inputText value="#{interCur.input.inputValue}" maxlength="255" style="width:395px;" styleClass="interModal"
                            onkeypress="return disableEnterKey(event);"/>
                    </span>
                </a4j:region>     
                
                <!-- list -->
                <a4j:region id="listInteractionRegion"  rendered="#{interCur.displayType == 'list'}">
                <span id="listInteractionRegion_#{interCurIdx}">
                    
                
                    <h:panelGroup style="width:250px" layout="block" >
                    <h:inputText value="#{interCur.list.selectedListOption}" id="selectedListOptionCombo#{interCurIdx+1}" 
                    	rendered="#{interCur.list.comboBox == 'Y'}" style="width:245px" >
                                  	 
	                    <script type="text/javascript">
	                    	jQuery("[id$='selectedListOptionCombo#{interCurIdx+1}']").textext({
						    	plugins : 'arrow autocomplete'
						    }).bind('getSuggestions', function(e, data){
	
							try{
							        	
								var list =  #{interCur.list.listOptionsString}  ,
							    	textext = jQuery(e.target).textext()[0],
							        query = (data ? data.query : '') || '' ;
							
							        jQuery(this).trigger('setSuggestions', {
								    	result : textext.itemManager().filter(list, query)
								    	}
							        );
	
								}catch(exception){
									alert(exception);
								}
						            
							});
						</script>
                               	 
                    </h:inputText>
                    </h:panelGroup>
                    
                    
                    
                    <h:selectOneRadio value="#{interCur.list.selectedListOption}" rendered="#{interCur.list.comboBox == 'N'}" layout="pageDirection" >
                        <f:selectItems value="#{interCur.list.listOptions}" />
                    </h:selectOneRadio>
                </span>
                </a4j:region>
                <!-- appendList -->
                <a4j:region id="appendListInteractionRegion" rendered="#{interCur.displayType == 'appendList'}">
                <span id="appendListInteractionRegion_#{interCurIdx}">
                    <rich:listShuttle sourceValue="#{interCur.appendList.sortedAppendListOptions}"
			            targetValue="#{interCur.appendList.selectedAppendListOptions}" var="items" listsHeight="150"
			            sourceListWidth="130" targetListWidth="130"
			            rendered="#{interCur.appendList.comboBox == 'sortedList'}"
			            copyAllControlLabel="Select all"
                        copyControlLabel="Select"
                        removeAllControlLabel="Unselect all"
                        removeControlLabel="Unselect"> 
			            <rich:column width="18"> 
			            	<h:outputText value="#{items}" />
			            </rich:column>
			        </rich:listShuttle>
			        
			        <rich:pickList copyAllControlLabel="Select all" copyControlLabel="Select" removeAllControlLabel="Unselect all"
                        removeControlLabel="Unselect" value="#{interCur.appendList.selectedAppendListOptions}" 
                        rendered="#{interCur.appendList.comboBox == 'list'}" >
                        <f:selectItems value="#{interCur.appendList.appendListOptions}" />
                    </rich:pickList>
                    
                    
                    <h:selectManyCheckbox value="#{interCur.appendList.selectedAppendListOptions}" rendered="#{interCur.appendList.comboBox == 'checkbox'}" layout="pageDirection" >
                        <f:selectItems value="#{interCur.appendList.appendListOptions}" />
                    </h:selectManyCheckbox>
                </span>
                </a4j:region>
                <!-- browser -->
                <a4j:region id="browserInteractionRegion" rendered="#{interCur.displayType == 'browser'}">
                	
                	<span id="browserInteractionRegion_#{interCurIdx}">
	                    <rich:panel style="border:none;width:100%;" id="browserPanel" >
	                    
	                        <h:outputText value="#{messages.label_path}" />
	                        <br/>
	                        <h:inputText id="browserPath" label="Path" value="#{interCur.browser.path}" maxlength="255" 
	                            style="width:395px;" styleClass="interModal" onclick="openModalOutputBrowserCM();" />
	                            
	                        <a4j:commandLink style="color:#FFFFFF" onclick="openModalOutputBrowserCM();" >
								<h:graphicImage value="../image/icons/button-search.gif" title='#{messages.filesystem_change_path}' styleClass="refreshButton" />
							</a4j:commandLink>
	            
	                        <br/><br/>
	                        
	                        <div id="browserProperties" style="width:100%;height:80px;border:1px solid black;">
	                        
	                            <rich:extendedDataTable id="browserTableProp" value="#{interCur.browser.listProperties}"
	                                var="property" width="100%" style="border:none;" onRowMouseOver="this.style.backgroundColor='#f2b97a'"
	                                enableContextMenu="false" selectionMode="none" rowKeyVar="index"
	                                onRowMouseOut="this.style.backgroundColor='#{a4jSkin.rowBackgroundColor}'"
	                                rowClasses="even-row, odd-row" >
	                                
	                                <rich:column id="browserPropLabel" >
	                                    <f:facet name="header">
	                                        <h:outputText value="#{messages.label_properties}" />
	                                    </f:facet>
	                                    <h:inputText styleClass="interModal" value="#{property.label}" style="border:none !important;width:95%;" readonly="true" onclick="setPropValueFocus(#{index});" />
	                                </rich:column>
	                                <rich:column id="browserPropValue" >
	                                    <f:facet name="header">
	                                        <h:outputText value="#{messages.label_value}" />
	                                    </f:facet>
	                                    <h:inputText id="browserPropValueInput" styleClass="interModal" value="#{property.value}" style="border:none !important;width:95%;" />
	                                </rich:column>
	                
	                            </rich:extendedDataTable>
	                        
	                        </div>
	                        
	                        <br/>
	                        
	                        <div id="divBrowserData" style="width:100%;height:120px;border:1px solid black;">
	                        
	                            <rich:scrollableDataTable id="browserTableData" value="#{interCur.browser.gridRows}" height="100%"
	                                var="rowData" index="rowDataIndex" width="100%" style="border:none;" onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
	                                enableContextMenu="false"
	                                onRowMouseOut="this.style.backgroundColor='#{a4jSkin.rowBackgroundColor}'"
	                                rowClasses="even-row, odd-row" >
	                       
	                                <rich:columns value="#{canvasModalBean.outputTab.titles == null? canvasBean.emptyList : canvasModalBean.outputTab.titles}" 
	                                	var="column" index="ind" id="column#{ind}" sortExpression="#{rowData[ind]}">
	                                    
	                                    <f:facet name="header">
	                                    	<h:panelGroup>
		                                    	<a4j:commandLink onclick="openHeaderEditorPanel('#{interCur.id}')" rendered="#{ind == 0 &amp;&amp; interCur.browser.updatableHeader == 'true'}" >
						                            <h:graphicImage url="../image/icons/button-pencil02.gif" style="width:15px;margin-right:8px;" title="#{messages.header_editor}"/>
												</a4j:commandLink>
		                                        <h:outputText value="#{column}" rendered="#{ind == 0 &amp;&amp; interCur.browser.updatableHeader == 'true'}" 
		                                        	style="position:relative;top:-6px;" />
		                                        <h:outputText value="#{column}" rendered="#{ind != 0 or interCur.browser.updatableHeader != 'true'}" />
	                                        </h:panelGroup>
	                                    </f:facet>
	                                    
	                                    <h:outputText value="#{rowData[ind]}" title="#{rowData[ind]}" converter="numberConverter" />
	                                    
	                                </rich:columns>
	                
	                            </rich:scrollableDataTable>
	                
	                        </div>
	                        
	                    </rich:panel>
                	</span>
	                	
                </a4j:region>
                
                <!-- helpTextEditor -->
                <a4j:region id="textEditorInteractionRegion" rendered="#{interCur.displayType == 'helpTextEditor'}">
	                <span id="textEditorInteractionRegion_#{interCurIdx}">
	                    <rich:panel style="border:none;" id="helpTextEditorPanel" >
	                        <h:outputText value="#{messages.label_formula}" />
	                        <br/>
	                        
	                        <h:inputTextarea maxlength="100" cols="90" rows="10" value="#{interCur.editor.textEditorValue}" 
	                        	style="resize:none;border:1pxsolid;width:93%;" id="command">
	                        	
	                       		<a4j:commandLink onclick="openHelpTextEditorModal('#{interCur.id}');"  
		                            rendered="#{interCur.editor.openPopup == 'Y'}">
		                            <h:graphicImage url="../image/icons/button-pencil02.gif" style="width:35px;float:right;margin-top:10px;margin-right: 5px;" title="#{messages.label_text_editor}"/>
								</a4j:commandLink>
	                        </h:inputTextarea>
	                        
	                        <br/>
	                        <br/>
	                    </rich:panel>
                	</span>
                </a4j:region>
                
                <!-- table -->
                <a4j:region id="tableInteractionRegion" rendered="#{interCur.displayType == 'table'}">
                <span id="tableInteractionRegion_#{interCurIdx}" >
                    <rich:panel style="border:none;" id="tablePanel">
        
                        <h:panelGrid id="table" columns="4" rendered="#{!empty interCur.table.tableGeneratorMenu}">
                        	<h:outputText value="#{messages.label_generation}" />
							
							
                            
                            <h:inputText value="#{interCur.table.selectedGenerator}" id="generation" >
                                  	 
                                 <script type="text/javascript">
                                   	jQuery("[id$='generation']").textext({
								            plugins : 'arrow autocomplete'
								        }).bind('getSuggestions', function(e, data){

											try{
									        	
									            var list =  #{interCur.table.tableGeneratorMenuString}  ,
									                textext = jQuery(e.target).textext()[0],
									                query = (data ? data.query : '') || '' ;
									
									            jQuery(this).trigger('setSuggestions', {
										            	result : textext.itemManager().filter(list, query)
										            }
									            );

											}catch(exception){
											    alert(exception);
											}
								            
								        });
								</script>
                                  	 
                            </h:inputText>
                            
                            
                            
    
                            <a4j:commandButton type="submit" styleClass="greenButton" id="tableInteractionGenerationLines"
                                action="#{interCur.table.generateLines}" value="#{messages.button_ok}" reRender="tableInteraction">
                            </a4j:commandButton>
                            
                            <a4j:commandButton action="#{canvasModalBean.openTableInteractionPanel}" value="#{messages.button_configure}" styleClass="greenButton"  
	                        	reRender="tableInteractionPanelPopUp" oncomplete="#{rich:component('tableInteractionPanel')}.show();" >
	                        	<a4j:actionparam name="idInteraction" value="#{interCur.id}"/>
	                        </a4j:commandButton>
                            
                        </h:panelGrid>
                        
                        <a4j:commandLink title="#{messages.label_add_new_line}" action="#{interCur.addNewLine}" reRender="tableInteraction" oncomplete="changeTableInteractionAnchorBottom();">
                            <img id="tableInteractionBtAdd" src="../image/icons/button-plus-small.gif" class="btConfigureFooter" />
                        </a4j:commandLink>
                        
                        <a4j:commandLink style="float:right;" title="Resize" onclick="toggleTableSize();">
                            <img id="tableInteractionBtResize" src="../image/icons/resize-6-24.gif" />
                        </a4j:commandLink>
                        
                        <table style="width:100%">
                        	<tr style="width:100%">
                        		<td style="width:95%">
                        		
                        			<div id="divTableInteraction" style="width:100%; height: 220px; border: 1px solid grey; overflow-x: hidden;">
                            
			                            <rich:dataTable id="tableInteraction" value="#{interCur.table.tableGridRows}"
			                                var="rowItem" rowKeyVar="rowNb" width="100%" style="border:none;" 
			                                onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
			                                enableContextMenu="false" 
			                                onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'" >
			        
			                                <rich:column style="border-bottom:0px;border-right:0px;"
			                                    width="20px;">
			                                    <h:outputText value="#{rowNb+1}" />
			                                </rich:column>
			        
			                                <rich:column style="border-bottom:0px;border-right:0px;" width="40px;">
			                                    <f:facet name="header">
			                                        <h:panelGrid columns="1" >
				                                        <a4j:commandLink title="Delete selected lines"
				                                            action="#{interCur.table.deleteLine}" reRender="tableInteraction"
				                                            onclick="if(!confirm('Are you sure you want to delete the selected line?')){return false;}">
				                                            <img id="tableInteractionBtDelete" src="../image/icons/button-delete-small.gif" class="btConfigureFooter" />
				                                        </a4j:commandLink>
				                                        <h:selectBooleanCheckbox onclick="selectAllCheckbox(this, /tableInteractionSelect$/);"/>
			                                        </h:panelGrid>
			                                    </f:facet>
			        
			                                    <h:selectBooleanCheckbox id="tableInteractionSelect" value="#{rowItem.selected}">
			                                        <f:selectItem itemValue="true" />
			                                    </h:selectBooleanCheckbox>
			        
			                                </rich:column>
			                                
			                                <rich:columns value="#{canvasModalBean.tablesColumnTitle == null? canvasBean.emptyList : canvasModalBean.tablesColumnTitle}"
			                                    var="column" index="ind"
			                                    style="border-bottom:0px;border-right:0px;">
			                                    <f:facet name="header">
			                                        <h:outputText value="#{column}" />
			                                    </f:facet>
			        
			                                    <h:inputText value="#{rowItem.row[ind]}"
			                                        rendered="#{interCur.table.columnType[column] == 'textField' }"
			                                        styleClass="tableInteractionInput"
			                                        onkeypress="return disableEnterKey(event);"/>
			                                        
			                                        
			                                        <h:panelGroup style="max-width:100px;" layout="block" rendered="#{interCur.table.columnType[column] == 'comboBox' }" >
			                                        <select onchange="updatedComboboxTableInteraction(this,'#{ind}#{rowNb+1}');" style="max-width:100px;">
			                                        	<option></option>
										            	<a4j:repeat value="#{interCur.table.tableConstraints[column]}" var="idx"  >
													       <h:outputText rendered="#{rowItem.row[ind] == idx.value}" > <option selected="selected"> <h:outputText value="#{idx.value}" /> </option> </h:outputText>
													    	<h:outputText rendered="#{rowItem.row[ind] != idx.value}" > <option> <h:outputText value="#{idx.value}" /> </option> </h:outputText>
														</a4j:repeat>
										            </select>
										            
										            <div id="combo#{ind}#{rowNb+1}">
														<h:inputHidden value="#{rowItem.row[ind]}" id="combo#{ind}#{rowNb}ans"/>
													</div>
													
													</h:panelGroup>
													
													<a4j:jsFunction name="reLoadInputHidden" reRender="combo#{ind}#{rowNb}ans" />
			        
												<h:inputText value="#{rowItem.row[ind]}" 
												       rendered="#{interCur.columnType[column] == 'editor' }" 
												       styleClass="tableInteractionTextEditor" >
			                                   	<a4j:commandLink onclick="openHelpTextEditorModal('#{interCur.id}','#{rowNb}','#{column}');" >
			                                   	    <h:graphicImage url="../image/icons/button-pencil.gif" style="width:15px;float:right" title="#{messages.label_text_editor}" />
												</a4j:commandLink>
												</h:inputText>
			        
			                                </rich:columns>
			        
			                            </rich:dataTable>
			                            
			                    	</div>
                        			
                        		</td>
                        		<td style="width:5%">
                        		
                        			<div style="width:100%; height: 220px; border: 0px solid; overflow-x: hidden;">
                        				<h:inputText id="newNumberRow" value="#{interCur.table.tableGrid.rowNumber}" maxlength="4" size="1" title="#{messages.button_goto}" onkeyup="noLetters(this);" onkeypress="return enableEnterKey(event, 'goNumberRowButton');" style="margin-top: 50px;border:1px solid;" />
		                            	<a4j:commandButton id="goNumberRowButton" action="#{interCur.table.tableGrid.goNumberRow}" reRender="tableInteraction,newNumberRow" style="display:none;" />
		                            	<br/><br/>
		                            	<a4j:commandButton styleClass="greenButton" style="width:40px;" value="#{messages.button_first}" action="#{interCur.table.tableGrid.goFirst}" reRender="tableInteraction" onclick="this.disabled=true" oncomplete="changeTableInteractionAnchorTop();this.disabled=false;" />
		                            	<br/>
		                            	<a4j:commandButton styleClass="greenButton" style="width:40px;" value="#{messages.button_up}" action="#{interCur.table.tableGrid.goUp}" reRender="tableInteraction" onclick="this.disabled=true" oncomplete="changeTableInteractionAnchorUp();this.disabled=false;" />
		                            	<br/>
		                            	<a4j:commandButton styleClass="greenButton" style="width:40px;" value="#{messages.button_down}" action="#{interCur.table.tableGrid.goDown}" reRender="tableInteraction" onclick="this.disabled=true" oncomplete="changeTableInteractionAnchorDown();this.disabled=false;" />
		                            	<br/>
		                            	<a4j:commandButton styleClass="greenButton" style="width:40px;" value="#{messages.button_last}" action="#{interCur.table.tableGrid.goLast}" reRender="tableInteraction" onclick="this.disabled=true" oncomplete="changeTableInteractionAnchorBottom();this.disabled=false;" />
		                            </div>
                        		
                        		</td>
                        	</tr>
                        </table>
                        
                    </rich:panel>
                </span>
                </a4j:region>
            </a4j:repeat>
            
            
        </rich:panel>
            
            <br/>
            <h:panelGrid columns="2" width="100%">
            
            <h:selectOneRadio id="quickNavigation" styleClass="wizzard_quick_navig" rendered="true" value="#{canvasModalBean.pageToGoTo}" >
                <f:selectItems value="#{canvasModalBean.reachablePages}" />
                <a4j:support event="onchange" action="#{canvasModalBean.goToPage}" oncomplete="setPageNb('#{canvasModalBean.idGroup}','#{canvasModalBean.listPosition}');createOptionTitles();" reRender="canvasModalTabPanel, panelDynamicForm, panelBtCanvasModal, browserPanel, browserTableData, msnError" />
            </h:selectOneRadio>
                    
            <rich:panel id="panelBtCanvasModal" style="border:none; float:right;" >
            
                <a4j:commandButton styleClass="greenButton" value="#{messages.button_cancel}" onclick="closeDynamicForm();" reRender="panelBtCanvasModal, msnError, errorTable" />
                
                <a4j:commandButton action="#{canvasModalBean.previousPage}" styleClass="greenButton" value="#{messages.button_previous}" rendered="#{canvasModalBean.firstPage == 'N'}" reRender="canvasModalTabPanel,  panelDynamicForm, panelBtCanvasModal, browserPanel, browserTableData, msnError" oncomplete="changeHelpAnchor('#{canvasModalBean.listPosition}');setPageNb('#{canvasModalBean.idGroup}','#{canvasModalBean.listPosition}');createOptionTitles();" />
                
                <a4j:commandButton action="#{canvasModalBean.applyPage}" styleClass="greenButton" value="#{messages.button_apply}" reRender="canvasModalTabPanel, outputTab, panelBtCanvasModal, msnError, msnSuccess, browserTableProp, browserPropLabel, browserPropValue" oncomplete="changeHelpAnchor('#{canvasModalBean.listPosition}');setPageNb('#{canvasModalBean.idGroup}','#{canvasModalBean.listPosition}');createOptionTitles();if(browserTableData){reLoadTabs();}" />
    
                <a4j:commandButton action="#{canvasModalBean.nextPage}" styleClass="greenButton" value="#{messages.button_next}" rendered="#{canvasModalBean.lastPage == 'N'}" reRender="canvasModalTabPanel,  panelDynamicForm, panelBtCanvasModal, browserPanel, browserTableData, msnError" oncomplete="changeHelpAnchor('#{canvasModalBean.listPosition}');setPageNb('#{canvasModalBean.idGroup}','#{canvasModalBean.listPosition}');createOptionTitles();" />
                
                <a4j:commandButton action="#{canvasModalBean.applyPage}" value="#{messages.button_ok}" oncomplete="if(#{requestScope['msnError'] == null} )closeDynamicForm();" styleClass="greenButton" rendered="#{canvasModalBean.lastPage == 'Y'}" reRender="msnError, errorTable" />
            
            </rich:panel>
            </h:panelGrid>
         </rich:tab>
            
            <rich:tab id="outputTab" label="#{messages.label_dynamic_data}"  
            	rendered="#{canvasModalBean.outputTab.showOutputForm == 'Y' &amp;&amp; canvasBean.workflowType == 'W' }"
            	oncomplete="setTimeout(function(){reLoadDisplayTable()},500);" >
                
                
                <rich:panel id="dataOutputForm" style="height:465px;border:none;overflow:auto;padding-right: 3px;padding-left: 3px;">
                    
	                <table style="width:100%;display:block;">
	                    <tbody style="width:100%">
	                        <tr style="width:100%;right:0px;position:relative;">
	                            <td style="width:50px;padding:0px;margin:0px;" >
	                                <img src="#{canvasModalBean.pathImage}"/>
	                            </td>
	                            <td style="width:700px;padding:0px;margin:0px;">
	                                <h1><h:outputText value="#{messages.label_node_output}"/></h1>
	                            </td>
	                        </tr>
	                    </tbody>
	                </table>
	                
	                <br/>
	                    <table>
	                    
	                    	<a4j:jsFunction name="onchangeOutputCombo" action="#{item.updateSavingState}" reRender="dataOutputForm" />
	                    
		                    <a4j:repeat value="#{canvasModalBean.outputTab.outputFormList}" var="item" rowKeyVar="index">
		                        
		                       	<tr>
		                       		<td>
		                       			<a4j:commandLink value="output #{item.name}"
		                       			    rendered="#{item.link == null}" 
		                       			    action="#{canvasModalBean.outputTab.displayOutput}"
		                       				reRender="displayTable,displayTableNumberRows, displayTableNumberRowsPanelGroup">
			                                <a4j:actionparam name="outputName" value="#{item.name}" />
			                                <a4j:actionparam name="resetMaxRows" value="Y" />
			                            </a4j:commandLink>
			                            <h:outputLink value="#{item.link}"
			                                rendered="#{item.link != null}"
			                            	target="blank">
											<h:outputText value="output #{item.name}" />
										</h:outputLink>
		                       		</td>
		                       		<td>
			                            
			                            
			                            
			                            <h:panelGroup style="width:100px" layout="block" >
					                    <h:inputText value="#{item.savingState}" id="outputCombo#{index+1}" style="width:95px" >
					                                  	 
						                    <script type="text/javascript">
						                    	jQuery("[id$='outputCombo#{index+1}']").textext({
											    	plugins : 'arrow autocomplete'
											    }).bind('getSuggestions', function(e, data){
						
												try{
													
													var list = #{item.savingStateListString} ,
												    	textext = jQuery(e.target).textext()[0],
												        query = (data ? data.query : '') || '' ;
												
												        jQuery(this).trigger('setSuggestions', {
													    	result : textext.itemManager().filter(list, query)
													    	}
												        );
						
													}catch(exception){
														alert(exception);
													}
											            
												});
				
						                    	jQuery("[id$='outputCombo#{index}']").bind('setFormData', function(e, data, isEmpty){
						                    		onchangeOutputCombo();
						                    	});
						                    	
											</script>
					                               	 
					                    </h:inputText>
					                    </h:panelGroup>
			                            
			                            
			                            
			                            
		                       		</td>
		                       		<td>
		                       			<a4j:commandButton value="Select" styleClass="greenButton"
			                                rendered="#{item.renderBrowserButton}" oncomplete="openModalOutputBrowser('Y');">
			                                <a4j:actionparam name="nameOutput" value="#{item.name}" assignTo="#{canvasModalBean.outputTab.nameOutput}" />
			                            </a4j:commandButton>
		                       		</td>
		                       		<td>
		                       			<h:outputText value="#{item.path}"/>
		                       		</td>
		                       		<td>
		                       			<h:inputText styleClass="interModal" value="#{item.file}" maxlength="40" style="width:100px;" rendered="#{item.renderBrowserButton}" onkeyup="nospaces(this);" />
		                       		</td>
		                       		<td>
		                       			<a4j:commandButton value="#{messages.button_remove}" action="#{canvasModalBean.outputTab.removeData}" styleClass="greenButton" >
			                                <a4j:actionparam name="nameOutputClean" value="#{item.name}" />
			                            </a4j:commandButton>
		                       		</td>
		                   		</tr>
		                        
		                    </a4j:repeat>
	                    
	                    </table>
	                    
	                <!-- display data -->
	                <a4j:region style="border:none;" id="dataDisplayReg">
	                
		                <h:outputText value="#{canvasModalBean.outputTab.nameOutput}" id="titleDisplay" rendered="#{canvasModalBean.outputTab.titles != null}"/>
		                <br/>
		                <div id="displayTableDiv" style="width:100%; height:240px; border:1px solid black; overflow-x: hidden;">
		                
		                    <rich:scrollableDataTable id="displayTable" value="#{canvasModalBean.outputTab.rows}" height="100%"
		                        var="rowData" index="rowDataIndex" width="100%" style="border:none;" onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
		                        rowKeyVar="rowNb" enableContextMenu="false"
		                        onRowMouseOut="this.style.backgroundColor='#{a4jSkin.rowBackgroundColor}'"
		                        rowClasses="even-row, odd-row" >
		               
		                		<rich:column style="border-bottom:0px;border-right:0px;" width="25px">
                                    <h:outputText value="#{rowNb+1}" />
                                </rich:column>
              
		                        <rich:columns value="#{canvasModalBean.outputTab.titles == null? canvasBean.emptyList : canvasModalBean.outputTab.titles}" 
		                        	var="column" index="ind" id="column#{ind}" sortExpression="#{rowData[ind]}">
		                            
		                            <f:facet name="header">
		                                <h:outputText value="#{column}" />
		                            </f:facet>
		                            
		                            <h:outputText value="#{rowData[ind]}" title="#{rowData[ind]}" converter="numberConverter" />
		                            
		                        </rich:columns>
		        
		                    </rich:scrollableDataTable>
		        
		                </div>
		                
		                <br/>
		                
		                <div id="displayTableComboNumberRowsDiv">
		                
		                 	<h:outputText value="#{messages.number_rows}" title="#{messages.number_rows}" />
		                 	
		                 	<br/>
		                	
		                	<a4j:jsFunction name="onchangeDisplayTableNumberRows" oncomplete="reLoadTable();blockComoBoxNumberRows();" reRender="displayTableNumberRows, displayTableNumberRowsPanelGroup" />
		                	
		                	<a4j:jsFunction name="reLoadTable" action="#{canvasModalBean.outputTab.displayOutput}" oncomplete="unBlockComoBoxNumberRows();" 
			                	reRender="displayTable, displayTableNumberRows, displayTableNumberRowsPanelGroup" />
		                    
	               			<h:panelGroup style="width:150px" layout="block" id="displayTableNumberRowsPanelGroup" >
	                        	<select onchange="updatedMaxRows(this);" >
				            		<a4j:repeat value="#{canvasModalBean.outputTab.maxNumberRows}" var="idx"  >
										<h:outputText rendered="#{canvasModalBean.outputTab.maxRows == idx.value}" > <option selected="selected"> <h:outputText value="#{idx.value}" /> </option> </h:outputText>
										<h:outputText rendered="#{canvasModalBean.outputTab.maxRows != idx.value}" > <option> <h:outputText value="#{idx.value}" /> </option> </h:outputText>
									</a4j:repeat>
				            	</select>
				            </h:panelGroup>
				             
				            <script type="text/javascript">
					            function updatedMaxRows(element){
								    var idx=element.selectedIndex;
								    var val=element.options[idx].value;
								    var content=element.options[idx].innerHTML;
								    jQuery("[id$='displayTableNumberRows']").val(val);
								    //alert(val + " " + content);
								    onchangeDisplayTableNumberRows();
								}
				            </script>
							<h:inputHidden value="#{canvasModalBean.outputTab.maxRows}" id="displayTableNumberRows" />
		                
		                </div>
		                
	                </a4j:region>
    
                </rich:panel>
                
                    <rich:panel columns="3" style="border:none; float:right;">
                        <a4j:commandButton styleClass="greenButton" value="#{messages.button_cancel}" onclick="closeDynamicForm();" reRender="panelBtCanvasModal, msnError, errorTable" />
                        <a4j:commandButton value="#{messages.button_apply}" styleClass="greenButton" action="#{canvasModalBean.outputTab.confirmOutput}" />
                        <a4j:commandButton value="#{messages.button_ok}" styleClass="greenButton" action="#{canvasModalBean.outputTab.confirmOutput}" oncomplete="if(#{requestScope['msnError'] == null}){#{rich:component('canvasModalPanel')}.hide();updateOutputStatus('#{canvasModalBean.idGroup}')}" reRender="msnError, errorTable" />
                    </rich:panel>
                
            </rich:tab>
        </rich:tabPanel>
        
    </div>
    
    </h:form>
            
    <rich:modalPanel id="modalOutputBrowser" width="800" height="430" style="overflow:hidden;" resizeable="false">

        <f:facet name="header">Browser</f:facet>
        <f:facet name="controls">
            <h:graphicImage value="../image/icons/buttonCloseWindow.gif" style="cursor:pointer;width:22px;"
                onclick="#{rich:component('modalOutputBrowser')}.hide()" />
        </f:facet>

        <h:form>
            <h:panelGroup>
                <a4j:include viewId="/pages/modalOutputBrowser.xhtml" ajaxRendered="true" />
            </h:panelGroup>
        </h:form>

    </rich:modalPanel>

    <rich:modalPanel id="textEditorPanel" width="700" height="450" style="overflow:hidden;" >
            
	    <f:facet name="header">
	    	<h:outputText value="#{messages.label_Editor}" />
	    </f:facet>
	    <f:facet name="controls">
	    	<h:graphicImage value="../image/icons/buttonCloseWindow.gif" style="cursor:pointer;width:22px;"
	            onclick="#{rich:component('textEditorPanel')}.hide()" />
	    </f:facet>
	    
	    <h:form>
		    <h:panelGroup>
		    	<ui:include src="/pages/canvasModalEditorPopup.xhtml" />
		    </h:panelGroup>
	    </h:form>
            
    </rich:modalPanel>
    
    <rich:modalPanel id="tableInteractionPanel" width="650" height="420" style="overflow:hidden;" >
            
	     <f:facet name="header">
	     	<h:outputText value="#{messages.label_generator_configuration}" />
	     </f:facet>
	     <f:facet name="controls">
	         <h:graphicImage value="../image/icons/buttonCloseWindow.gif" style="cursor:pointer;width:22px;"
	             onclick="#{rich:component('tableInteractionPanel')}.hide()" />
	     </f:facet>
	     
	     <h:panelGroup>
	         <a4j:include viewId="/pages/tableInteractionPanelPopup.xhtml" ajaxRendered="true" />
	     </h:panelGroup>
            
    </rich:modalPanel>
    
    <rich:modalPanel id="headerEditor" width="700" height="450" style="overflow:hidden;" >
            
	    <f:facet name="header">
	    	<h:outputText value="#{messages.header_editor}" />
	    </f:facet>
	    <f:facet name="controls">
	    	<h:graphicImage value="../image/icons/buttonCloseWindow.gif" style="cursor:pointer;width:22px;"
	            onclick="#{rich:component('headerEditor')}.hide()" />
	    </f:facet>
	    
	    <h:panelGroup>
	    	<a4j:include viewId="/pages/headerEditor.xhtml" ajaxRendered="true" />
	    </h:panelGroup>
            
    </rich:modalPanel>
    
</ui:composition>
