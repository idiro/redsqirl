<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"   
      xmlns:ui="http://java.sun.com/jsf/facelets"   
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:p="http://xmlns.jcp.org/jsf/passthrough">
      
      <a4j:loadBundle basename="MessagesResources" var="messages" />
      
	<head>
		<link rel="stylesheet" href="#{facesContext.externalContext.requestContextPath}/css/table-style.css" />
		<link rel="stylesheet" href='#{facesContext.externalContext.requestContextPath}/css/redsqirl.css' />
		<script src='#{facesContext.externalContext.requestContextPath}/js/jquery-1.9.1.js' type="text/javascript"></script>
		<script src='#{facesContext.externalContext.requestContextPath}/js/redsqirl-pck-manager.js' type="text/javascript"></script>
		<script	src="#{facesContext.externalContext.requestContextPath}/js/redsqirl.js"	type="text/javascript" ></script>
		
		<title><h:outputText value="#{messages.label_sistem}" /></title>
   		
   		<script>

			jQuery.noConflict();
			
			jQuery(function() {

				updateDefaultInstallation();	

				if(#{analyticsStoreSearchBean.showDefaultInstallation == 'Y'}){
					#{rich:component('defaultInstallation')}.show();	
				}else{
					#{rich:component('defaultInstallation')}.hide();
					jQuery('[id$="searchPckBt"]').click();
				}
				
			});

		  function searchJS(){
			  jQuery('[id$="searchPckBt"]').click();
	      }
		
		</script>
   		
    </head>
 
 	<body>
		
		<h:form>
		
			<a4j:jsFunction name="updateDefaultInstallation" action="#{analyticsStoreSearchBean.init}" reRender="admlogin-form" />
		
		
			<h:panelGroup layout="block" class="searchBar">
				<center>
					<h:outputText value="Search:"/>
					<h:inputText value="#{analyticsStoreSearchBean.searchValue}"/>
					
					<a4j:commandButton id="searchPckBt" value="Search" action="#{analyticsStoreSearchBean.retrieveAllPackageList}" 
						render="out" styleClass="greenButton" />
				</center>
			</h:panelGroup>
		</h:form>
				 				
		<a4j:outputPanel id="out" ajaxRendered="true">
			<h:panelGroup layout="block" class="packageList">
				<a4j:repeat value="#{analyticsStoreSearchBean.allPackageList}" var="pck">
				 	<div class="packageItem" onclick="goToUrl(event, this);">
	                	<h:panelGroup layout="block" class="type" style="float:right;">
							<h:outputText value="#{pck.type}"/>
						</h:panelGroup>
	                	<h:graphicImage value="#{pck.image}" 
	                		width="100" height="100" styleClass="image"/>
					 	<h:panelGroup layout="block" class="title">
							<h:outputLink styleClass="hiddenLink" value="../secured/moduleDetail.xhtml">
							    <f:param name="id" value="#{pck.id}" />
							    <f:param name="userInstall" value="#{packageMngBean.userInstall}" />
							</h:outputLink>
							<h:outputText value="#{pck.name}"/>
						</h:panelGroup>
						<h:panelGroup layout="block" class="license">
						    <h:outputText value="#{pck.tags}  "/>
						</h:panelGroup>
					 </div>
				</a4j:repeat>
			</h:panelGroup>
		</a4j:outputPanel>
		
		
		
		<rich:modalPanel id="defaultInstallation" width="400" height="200" style="overflow:auto;" resizeable="false" >

			<f:facet name="header">
				<h:outputText value='#{messages.label_default_installation}' />
			</f:facet>
	
			<h:form>
			
				<h:panelGrid>
					<h:outputText value="#{messages.label_default_installation_info}" class="formLabel" />
					
					<br/>
					
					<h:outputText value="#{analyticsStoreSearchBean.defaultInstallation}" escape="false" />
				</h:panelGrid>
						
				<br/><br/>
				
				<center>
					<a4j:commandButton value="#{messages.button_ok}" action="#{analyticsStoreSearchBean.installDefaultInstallation}" reRender="msnSuccess"
						oncomplete="#{rich:component('defaultInstallation')}.hide();updateUninstalMenu();" styleClass="greenButton" />
					<a4j:commandButton value="#{messages.button_cancel}" oncomplete="#{rich:component('defaultInstallation')}.hide(); searchJS();" 
						styleClass="greenButton" />
				</center>
				
				<a4j:jsFunction name="updateUninstalMenu" action="#{analyticsStoreLoginBean.updateUninstalMenu}" reRender="menuModule" />
				
			</h:form>
			
			
			<h:form>
			
				<rich:modalPanel id="msnSuccess"
					showWhenRendered="#{requestScope['msnSuccess'] != null}">
					<div style="width: 100%; height: 100%; overflow: auto;">
						<rich:messages id="msgS" globalOnly="false" layout="list"
							styleClass="message" infoClass="messageok" errorClass="messageerro"
							warnClass="messagealert" showDetail="true" showSummary="false"
							ajaxRendered="false" />
						<a4j:commandButton styleClass="greenButton"
							value="#{messages.button_ok}"
							onclick="#{rich:component('msnSuccess')}.hide(); searchJS();"
							style="bottom:14%;position:relative;" reRender="msnSuccess, msgS" />
					</div>
				</rich:modalPanel>
			
			</h:form>
			
			
		</rich:modalPanel>
		
	</body>
</html>