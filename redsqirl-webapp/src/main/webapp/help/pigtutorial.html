<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">

<html>
<head>
  <title>Pig Tutorial</title>
</head>

<body>
  <h1>Pig Tutorial</h1>

  <h2>Goals:</h2>

  <ol>
      <li>Create Ssh Connections to remote
    servers</li>

    <li>Copy files from remote servers to
    Hadoop File system</li>

    <li>Change your footer menu</li>

    <li>Build workflows that perform queries
    over data sets</li>

    <li>Learn how to use some of the actions
    that are available in the Pig Package</li>
  </ol>

  <h2>Pig Workflow</h2>

  <h3>Copying file from a Remote to HDFS</h3>
  
  <p>
  The purpose
  of this task is to demonstrate the &ldquo;Remote File
  System&rdquo; functionality.</p>

  <p>It will show how to connect to remote servers
  and copying files from the remote server to the Hadoop file
  system.</p>
  

  <ol>
    <li>Click on Remote File System.</li>
    <li>Click the plus symbol to create a new
    ssh connection to a remote server.</li>
  	<li><ul>
    <li>Host : localhost</li>
    <li>Port : (do not select)</li>
    <li>Password : Give your password</li>
    <li>Save (do not select)</li>
  </ul></li>
    <li>Change the working directory to tutorialdata in the Red Sqirl home
    directory via the path that is above listed directories and click the search
    symbol.</li>


    <li>From the remote file system tab that
    should display the &ldquo;/${redsqirl_home}/tutorialdata/&rdquo; directory
    on localhost ,
    drag the file &ldquo;pig_tutorial_data.txt&rdquo; to the hadoop file
    system tab.</li>

    <li>Locate the &ldquo;pig_tutorial_data.txt&rdquo;
    file on the hadoop file system tab (might have to click the
    search beside the current path).</li>

    <li>Click the plus symbol to create a new
    directory on hadoop file system and give it the name
    &ldquo;pig_tutorial_data.mrtxt&rdquo;.</li>

    <li>Click the checkbox beside the
    &ldquo;pig_tutorial_data.txt&rdquo; folder and then click the move symbol
    under the current working directory.</li>

    <li>In the new window click the radio
    button beside &ldquo;pig_tutorial_data.mrtxt&rdquo; folder and click
    OK.</li>
  </ol>

  <h3>Change your footer</h3>

  <p>The action footer is the little frame on the bottom left of
  the FlowChart tab. Click the green information symbol. Once the
  configuration popup has appeared in the left column click &ldquo;+&rdquo;,
  enter &ldquo;extraPig&rdquo; and click the &ldquo;...&rdquo; symbol. Then click the checkbox beside
  all the pig actions and the source action and then click OK.</p>

  <p>You should see a new footer tab called &ldquo;extraPig&rdquo;.</p>

  <p>To remove this new menu, go back to the footer editor. Click on the check
  box beside &ldquo;extraPig&rdquo; and click on the Delete button.</p>

  <h3>Create a Workflow</h3>

  <!-- 
  <p>On the last page of every pig action there are options for the output of
  the action such as the delimiter to use, or the output type either Text or
  Compressed.  The delimiter can be any non alpha numeric value or an ASCII
  value such as &ldquo;#1&rdquo; which in ASCII value is &ldquo;\001&rdquo;.</p>
  -->

  <h4>Setup a Source Action</h4>
  
  <p>This Task will show how the source
  &ldquo;action&rdquo; can be configured to select flat files and
  change the properties such as the delimiter of the file and also
  the headings and types of the file. For this tutorial the
  workflow needs to be run after each action is configured except
  for source.</p>

  <ol>
    <li>In the actions footer drag a new source icon onto the canvas.</li>
    <li>Double click to open source.</li>
    <li>Name the action &ldquo;communication&ldquo;.</li>
    <li>Comment the action &ldquo;Configure tutorial data&ldquo;.</li>
    <li>Click OK.</li>

    <li>Select &ldquo;Hadoop Distributed File System&ldquo; as the data type
    then click next.</li>

    <li>Select &ldquo;TEXT MAP-REDUCE DIRECTORY&rdquo; as the data subtype and
    click next.</li>

    <li>On the data set screen, click on the path field or on the button.</li>

    <li>Click on the radio button beside &ldquo;pig_tutorial_data.mrtxt&rdquo;-
    if you cannot find it refresh the view by clicking on the search button-
    and click OK.</li>

    <li>At this stage, you will see the data correctly display on the
    screen, the name of the fields are &ldquo;Field1 Long, Field2 Long...&rdquo;</li>
    <li>On the feature title line, click on the edit button. Once it appears you
    can choose &ldquo;Change Header&rdquo; and paste &ldquo;subscriber_number STRING , Friend STRING ,
    offpeak_voice INT , offpeak_sms INT , offpeak_mms INT
    ,peak_voice INT,peak_sms INT , peak_mms INT , sna_weight INT ,
    subscriber_onnet INT ,friend_onnet INT&rdquo; into the value
    field. Click OK. You will have the confirmation that the Header is correct.</li>

    <li>Click OK to exit from the Configuration Window.</li>

    <li>If you leave the mouse cursor on the source action you will be able to
    see some configuration details</li>

    <li>Save the Workflow by going into File &gt; Save, name it
    &ldquo;pig_tutorial&rdquo;. By default it is saved in redsqirl-save HDFS
    directory and the file will have the extension &lsquo;.rs&rsquo;. Click OK
    to save.</li>


  </ol>

  
  <h4>Setup a Pig Aggregator Action</h4>
  
  <p> Pig Aggregator is an action in which aggregation methods are allowed to be
  used when selecting columns as you would in an sql statement.  These
  aggregation methods are AVG , MAX , SUM etc. This action will group by either
  the selected attributes or all (default if none is selected).</p>

  <ol>
    <li>Drag a pig aggregator action to the
    canvas.</li>
    
    <li>Create a link between the source that was just configured and the new
    pig aggregator action by clicking between the image and the arc of the
    source action and then clicking on the pig aggregator image.</li>

    <li>Open the new pig aggregator click, name the element &ldquo;nl_sum&rdquo;
    and Click OK.</li>

    <li>Select
    &ldquo;subscriber_number&rdquo; in the Group by interaction and
    click next.</li>

    <li>Select the copy from the dropdown menu
    on the generator interaction and click OK.</li>

    <li>On the top of the table click the
    &ldquo;+&rdquo; symbol to add a new row to the
    table.</li>

    <li>Click on the pen in Operation field of the new
    row and click the &ldquo;SUM()&rdquo; function and add the
    parameters &ldquo;communication.offpeak_voice&rdquo; and
    &ldquo;communication.peak_voice&rdquo;. In the between the parameters add a
    &ldquo;+&rdquo; symbol so that the operation would read
    &ldquo;SUM(communication.offpeak_voice + communication.peak_voice)&rdquo;and click
    OK.</li>

    <li>Once the operation field add the name
    &ldquo;total_voice&rdquo; for the new column, change
    the type to DOUBLE and click next.</li>

    <li>The next page sort the data, we won't sort by clicking next.</li>
    
    <li>The following page is about filter and format, click OK to leave the
    default parameters.</li> 

    <li>In Project, click &ldquo;Save and Run&rdquo; to run the workflow.</li>

    <li>To see the results, leave your mouse on the action &gt; Options &gt; Data
    Output.</li>
  </ol>


  <ol>
    <li>Drop another pig aggregator onto the
    canvas.</li>

    <li>Make a link between the source and the new pig aggregator.</li>

    <li>Open it, and give it the name "comm_groupbyall" and click OK.</li>

    <li>This time leave the group by list alone so nothing is selected and click
    next.</li>

    <li>Create a new row (+ button).</li>

    <li>In this new row write &ldquo;AVG(communication.offpeak_voice +
    communication.peak_voice)&rdquo;.</li>

    <li>Call the field &ldquo;total_voice_avg&rdquo; and select the DOUBLE type.</li>

    <li>Click next, next then OK on the final page.</li>
  </ol>

  <h4>Perform a Pig Join Action</h4>  

  <p> To make each dataset interactable with each other it is necessary to
  perform a join on them.</p>

  

  <ol>
    <li>Drop a pig join onto the canvas.</li>
    
    <li>Create a link from &ldquo;comm_groupbyall&rdquo; to the new
    pig join action.</li>

    <li>Create a link from &ldquo;nl_sum&rdquo; to the new
    pig join action.</li>

    <li>Double click the pig join and call it &ldquo;nl_vs_total&rdquo;.</li>
	
    <li>The first page list the table aliases, click next.</li>

    <li>On the following page, make sure that &ldquo;copy&rdquo; is selected as
    the generator and click OK.</li>

    <li>Click next.</li>

    <li>This page has two interaction that
    specify the join type and the fields to join on, we use the
    default join type which is &ldquo;Join&rdquo; so this does not
    need to be changed.</li>

    <li>In &ldquo;Join Field&rdquo; column, type &ldquo;1&rdquo; in the two rows. This condition will join
    the two tables together.</li>

    <li>Click next, next then OK on the final page.</li>
  </ol>

  
  <h4>Filter a Data set</h4>  

  <p> Now we want to make a condition to see what subscribers have a higher
  total voice calls than the average of the entire dataset. The easiest would be
  to add the condition in Join but we will create a new select for demonstration
  purposes.</p>


  <ol>
    <li>Drop a new pig select action onto the canvas.</li>
    
    <li>Create a link from the pig join action
    to the new pig select action</li>

    <li>Open it and change the element id to be &ldquo;high_voice&rdquo;.</li>

    <li>Use the copy generator and click next.</li>

    <li>In the Sorting page, select &ldquo;nl_sum_total_voice&rdquo; and
    &ldquo;DESCENDING&rdquo; order. Click Next.</li>

    <li>Click on the Pen in the Condition and write &ldquo;nl_sum_total_voice
    &gt; comm_groupbyall_total_voice_av&rdquo;.</li>


    <li>Click OK and then finish the action by clicking OK.</li>

  </ol>

  <p>We would like now to keep &ldquo;nl_vs_total&rdquo; intermediate result
  before running the workflow.</p>

  <ol>
      <li>Leave you mouse on &ldquo;nl_vs_total&rdquo; icon &gt; Options &gt; Data Output</li>
      <li>Select &ldquo;BUFFERED&rdquo; instead of &ldquo;TEMPORARY&rdquo;.</li>
      <li>Click OK.</li>
  </ol>

  <p>You can now &ldquo;Save and Run&rdquo;, and see your result in the Data
  Output of &ldquo;nl_vs_total&rdquo; and  &ldquo;high_voice&rdquo;</p> 

  <p>Once you are happy with the result you can clean all the data generated by
  this workflow by clicking on Project &gt; Clean Project.</p>

  <h4>Summary of workflow</h4>

  

  <p>In this workflow we have</p>

  <ol>
    <li>configured source for a hdfs file</li>

    <li>selected the sum of two columns</li>

    <li>gotten the average of a column</li>

    <li>gotten the sum of a column when grouping by another</li>

    <li>joined the two tables</li>

    <li>filtered a table with a condition</li>
  </ol>

</body>
</html>
